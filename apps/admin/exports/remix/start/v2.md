---
title: v2ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
order: 3
---

# v2ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

<docs-warning>ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€[Classic Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©][classic-remix-compiler] ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã® v1 ã‹ã‚‰ v2 ã¸ã®ç§»è¡Œã«é–¢ã™ã‚‹ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚Vite ã¸ã®ç§»è¡Œã«é–¢ã™ã‚‹è¿½åŠ ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ã€[Remix Vite ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ][remix-vite] ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</docs-warning>

ã™ã¹ã¦ã® v2 API ã¨å‹•ä½œã¯ã€[å°†æ¥ã®ãƒ•ãƒ©ã‚°][future-flags] ã‚’ä½¿ç”¨ã—ã¦ v1 ã§åˆ©ç”¨ã§ãã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºã‚’ä¸­æ–­ã—ãªã„ã‚ˆã†ã«ã€ä¸€åº¦ã«1ã¤ãšã¤æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã™ã¹ã¦ã®ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã—ãŸã‚‰ã€v2ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯ç ´å£Šçš„ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ãªã‚‰ãªã„ã¯ãšã§ã™ã€‚

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°][troubleshooting] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ä¸€èˆ¬çš„ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å•é¡Œã®ç°¡å˜ãªæ¦‚è¦ã«ã¤ã„ã¦ã¯ã€[ğŸ¥ 2 åˆ†ã§ v2 ã¸][2-min-to-v2] ã‚’ã”è¦§ãã ã•ã„ã€‚


[classic-remix-compiler]:  (Classic Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥)
[remix-vite]: (Remix Vite ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥)
[future-flags]: (å°†æ¥ã®ãƒ•ãƒ©ã‚°ã«é–¢ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥)
[troubleshooting]: (ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥)
[2-min-to-v2]: (2 åˆ†ã§ v2 ã¸å‹•ç”»ã¸ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥)

## `remix dev`

è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€[`remix dev` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ][dev-docs]ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


[dev-docs]:  (This needs a URL to be added here.  The original markdown left this as a placeholder.)

### `remix-serve`

Remixã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼(`remix-serve`)ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€`v2_dev`ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_dev: true,
  },
};
```

ä»¥ä¸Šã§ã™ï¼

### ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼

ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼(`server.js`)ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€`v2_dev`ã¨ã®çµ±åˆæ–¹æ³•ã®ä¾‹ã«ã¤ã„ã¦ã¯ã€[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][templates]ã‚’ã”è¦§ãã ã•ã„ã€‚ã¾ãŸã¯ã€æ¬¡ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚

1. `v2_dev`ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼š

   ```javascript filename=remix.config.js
   /** @type {import('@remix-run/dev').AppConfig} */
   module.exports = {
     future: {
       v2_dev: true,
     },
   };
   ```

2. `package.json`ã®`scripts`ã‚’æ›´æ–°ã™ã‚‹ï¼š

   * `remix watch`ã‚’`remix dev`ã«ç½®ãæ›ãˆã‚‹
   * å†—é•·ãª`NODE_ENV=development`ã‚’å‰Šé™¤ã™ã‚‹
   * ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«`-c` / `--command`ã‚’ä½¿ç”¨ã™ã‚‹

   ä¾‹ï¼š

   ```diff filename=package.json
    {
      "scripts": {
   -    "dev:remix": "cross-env NODE_ENV=development remix watch",
   -    "dev:server": "cross-env NODE_ENV=development node ./server.js"
   +    "dev": "remix dev -c 'node ./server.js'",
      }
    }
   ```

3. ã‚¢ãƒ—ãƒªãŒå®Ÿè¡Œã•ã‚ŒãŸã‚‰ã€Remixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã€Œreadyã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹

   ```typescript filename=server.js lines=[1-2,11]
   import { broadcastDevReady } from "@remix-run/node";
   // import { logDevReady } from "@remix-run/cloudflare" // CloudFlareã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯`logDevReady`ã‚’ä½¿ç”¨

   const BUILD_DIR = path.join(process.cwd(), "build");

   // ... ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ ...

   const port = 3000;
   app.listen(port, async () => {
     console.log(`ğŸ‘‰ http://localhost:${port}`);
     broadcastDevReady(await import(BUILD_DIR));
   });
   ```

4. (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)`--manual`

   `require`ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢ã«ä¾å­˜ã—ã¦ã„ãŸå ´åˆã¯ã€`--manual`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦å¼•ãç¶šãå®Ÿè¡Œã§ãã¾ã™ã€‚

   ```bash nonumber
   remix dev --manual -c 'node ./server.js'
   ```

   è©³ç´°ã¯ã€[ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰][manual-mode]ã‚’ã”è¦§ãã ã•ã„ã€‚


[templates]: <ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¸ã®ãƒªãƒ³ã‚¯>
[manual-mode]: <ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰ã¸ã®ãƒªãƒ³ã‚¯>

### v1ã‹ã‚‰v2ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œ

v1ã§`future.v2_dev`ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦å‹•ä½œç¢ºèªãŒæ¸ˆã‚“ã ã‚‰ã€v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
`v2_dev`ã‚’`true`ã«è¨­å®šã—ã¦ã„ãŸã ã‘ãªã‚‰ã€ãã‚Œã‚’å‰Šé™¤ã™ã‚Œã°å‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚

`v2_dev`è¨­å®šã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€`dev`è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff filename=remix.config.js
  /** @type {import('@remix-run/dev').AppConfig} */
  module.exports = {
-   future: {
-     v2_dev: {
-       port: 4004
-     }
-   }
+   dev: {
+     port: 4004
+   }
  }
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ«ãƒ¼ãƒˆè¦ç´„

#### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã›ãšã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹

ã™ãã«å¤‰æ›´ã—ãŸããªã„å ´åˆï¼ˆã¾ãŸã¯ã€ã¾ã£ãŸãå¤‰æ›´ã—ãŸããªã„å ´åˆã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã¯å˜ãªã‚‹æ…£ä¾‹ã§ã‚ã‚Šã€ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ä½¿ç”¨ã§ãã¾ã™ï¼‰ã€`@remix-run/v1-route-convention` ã‚’ä½¿ç”¨ã—ãŸå¤ã„è¦å‰‡ã‚’å¼•ãç¶šãv2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸå¾Œã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚

```shellscript nonumber
npm i -D @remix-run/v1-route-convention
```

```js filename=remix.config.js
const {
  createRoutesFromFolders,
} = require("@remix-run/v1-route-convention");

/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    // v1.15ä»¥é™ã§è­¦å‘Šã‚’æ¶ˆå»ã—ã¾ã™
    v2_routeConvention: true,
  },

  routes(defineRoutes) {
    // v1ã®è¦å‰‡ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚v1.15ä»¥é™ã¨v2ã§å‹•ä½œã—ã¾ã™
    return createRoutesFromFolders(defineRoutes);
  },
};
```

#### æ–°è¦è¦ç´„ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

* ãƒ«ãƒ¼ãƒˆã®ãƒã‚¹ãƒˆã¯ã€ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒã‚¹ãƒˆã§ã¯ãªãã€ãƒ•ã‚¡ã‚¤ãƒ«åå†…ã®ãƒ‰ãƒƒãƒˆï¼ˆ`.`ï¼‰ã§ä½œæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
* ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã® `suffixed_` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã¯ã€ãƒ‰ãƒƒãƒˆï¼ˆ`.`ï¼‰ã§ã¯ãªãã€æ½œåœ¨çš„ã«ä¸€è‡´ã™ã‚‹è¦ªãƒ«ãƒ¼ãƒˆã¨ã®ãƒã‚¹ãƒˆã‚’ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚
* ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã® `_prefixed` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã¯ã€`__double` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§ã¯ãªãã€ãƒ‘ã‚¹ã‚’æŒãŸãªã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
* `_index.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`index.tsx` ã§ã¯ãªãã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚


v1 ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ï¼š

```text bad
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __auth/
â”‚   â”‚   â”œâ”€â”€ login.tsx
â”‚   â”‚   â”œâ”€â”€ logout.tsx
â”‚   â”‚   â””â”€â”€ signup.tsx
â”‚   â”œâ”€â”€ __public/
â”‚   â”‚   â”œâ”€â”€ about-us.tsx
â”‚   â”‚   â”œâ”€â”€ contact.tsx
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ calendar/
â”‚   â”‚   â”‚   â”œâ”€â”€ $day.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â”œâ”€â”€ $projectId/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ collaborators.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ edit.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tasks.$taskId.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ $projectId.tsx
â”‚   â”‚   â”‚   â””â”€â”€ new.tsx
â”‚   â”‚   â”œâ”€â”€ calendar.tsx
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ projects.tsx
â”‚   â”œâ”€â”€ __auth.tsx
â”‚   â”œâ”€â”€ __public.tsx
â”‚   â””â”€â”€ dashboard.projects.$projectId.print.tsx
â””â”€â”€ root.tsx
```

`v2_routeConvention` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```text good
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _auth.login.tsx
â”‚   â”œâ”€â”€ _auth.logout.tsx
â”‚   â”œâ”€â”€ _auth.signup.tsx
â”‚   â”œâ”€â”€ _auth.tsx
â”‚   â”œâ”€â”€ _public._index.tsx
â”‚   â”œâ”€â”€ _public.about-us.tsx
â”‚   â”œâ”€â”€ _public.contact.tsx
â”‚   â”œâ”€â”€ _public.tsx
â”‚   â”œâ”€â”€ dashboard._index.tsx
â”‚   â”œâ”€â”€ dashboard.calendar._index.tsx
â”‚   â”œâ”€â”€ dashboard.calendar.$day.tsx
â”‚   â”œâ”€â”€ dashboard.calendar.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId._index.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.collaborators.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.edit.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.settings.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.tasks.$taskId.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.tsx
â”‚   â”œâ”€â”€ dashboard.projects.new.tsx
â”‚   â”œâ”€â”€ dashboard.projects.tsx
â”‚   â””â”€â”€ dashboard_.projects.$projectId.print.tsx
â””â”€â”€ root.tsx
```

è¦ªãƒ«ãƒ¼ãƒˆã¯ã€ï¼ˆèªè¨¼ãƒ«ãƒ¼ãƒˆã®ã‚ˆã†ã«ï¼‰ãã‚Œã‚‰ã®é–“ã«æ•°åã‚‚ã®ãƒ«ãƒ¼ãƒˆãŒã‚ã‚‹ã®ã§ã¯ãªãã€ä¸€ç·’ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ‘ã‚¹ã¯åŒã˜ã ãŒãƒã‚¹ãƒˆãŒç•°ãªã‚‹ãƒ«ãƒ¼ãƒˆï¼ˆ`dashboard` ã¨ `dashboard_` ãªã©ï¼‰ã‚‚ä¸€ç·’ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã¾ã™ã€‚


æ–°ã—ã„è¦ç´„ã§ã¯ã€ä»»æ„ã®ãƒ«ãƒ¼ãƒˆã‚’å†…éƒ¨ã« `route.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã™ã‚‹ã“ã¨ãŒã§ãã€ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®šç¾©ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä½¿ç”¨ã™ã‚‹ãƒ«ãƒ¼ãƒˆã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å…±å­˜ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ãŸã¨ãˆã°ã€`_public.tsx` ã‚’ `_public/route.tsx` ã«ç§»å‹•ã—ã€ãƒ«ãƒ¼ãƒˆãŒä½¿ç”¨ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å…±å­˜ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```text
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _auth.tsx
â”‚   â”œâ”€â”€ _public/
â”‚   â”‚   â”œâ”€â”€ footer.tsx
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â””â”€â”€ route.tsx
â”‚   â”œâ”€â”€ _public._index.tsx
â”‚   â”œâ”€â”€ _public.about-us.tsx
â”‚   â””â”€â”€ etc.
â””â”€â”€ root.tsx
```

ã“ã®å¤‰æ›´ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€[å…ƒã®ã€Œãƒ•ãƒ©ãƒƒãƒˆãƒ«ãƒ¼ãƒˆã€ææ¡ˆ][flat-routes] ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


[flat-routes]:  (ãƒ•ãƒ©ãƒƒãƒˆãƒ«ãƒ¼ãƒˆææ¡ˆã¸ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥ã—ã¦ãã ã•ã„)

## Route `headers`

Remix v2ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã®`headers`é–¢æ•°ã®å‹•ä½œãŒã‚ãšã‹ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚`remix.config.js`ã®`future.v2_headers`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦ã€ã“ã®æ–°ã—ã„å‹•ä½œã‚’äº‹å‰ã«ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã§ãã¾ã™ã€‚

v1ã§ã¯ã€Remixã¯ãƒªãƒ¼ãƒ•ï¼ˆæœ«ç«¯ï¼‰ã®ã€Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿ã€ãƒ«ãƒ¼ãƒˆã®`headers`é–¢æ•°ã®çµæœã®ã¿ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚ã™ã¹ã¦ã®æ½œåœ¨çš„ãªãƒªãƒ¼ãƒ•ã«`headers`é–¢æ•°ã‚’è¿½åŠ ã—ã€ãã‚Œã«å¿œã˜ã¦`parentHeaders`ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ã®ã¯é–‹ç™ºè€…ã®è²¬ä»»ã§ã—ãŸã€‚ã“ã‚Œã¯ã™ãã«é¢å€’ã«ãªã‚Šã€æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ã—ãŸã¨ãã«ã€è¦ªã‹ã‚‰ã®åŒã˜ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å…±æœ‰ã—ãŸã„å ´åˆã§ã‚‚ã€`headers`é–¢æ•°ã®è¿½åŠ ã‚’å¿˜ã‚Œã‚‹ã“ã¨ãŒå®¹æ˜“ã«èµ·ã“ã‚Šãˆã¾ã™ã€‚

v2ã§ã¯ã€Remixã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã®ä¸­ã§æœ€ã‚‚æ·±ã„`headers`é–¢æ•°ã‚’ç”¨ã„ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å…±é€šã®ç¥–å…ˆã‹ã‚‰ãƒ«ãƒ¼ãƒˆé–“ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚ˆã‚Šç°¡å˜ã«å…±æœ‰ã§ãã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ã€ç‰¹å®šã®å‹•ä½œãŒå¿…è¦ãªã‚ˆã‚Šæ·±ã„ãƒ«ãƒ¼ãƒˆã«`headers`é–¢æ•°ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

## Route `meta`

Remix v2ã§ã¯ã€ãƒ«ãƒ¼ãƒˆ`meta`é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã¨RemixãŒå†…éƒ¨çš„ã«ãƒ¡ã‚¿ã‚¿ã‚°ã‚’å‡¦ç†ã™ã‚‹æ–¹æ³•ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

`meta`ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ä»£ã‚ã‚Šã«ã€è¨˜è¿°å­ã®é…åˆ—ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã€ãƒãƒ¼ã‚¸ã‚’è‡ªåˆ†ã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Š`meta` APIã¯`links`ã«è¿‘ã¥ãã€ãƒ¡ã‚¿ã‚¿ã‚°ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ–¹æ³•ã«é–¢ã™ã‚‹æŸ”è»Ÿæ€§ã¨åˆ¶å¾¡æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

ã•ã‚‰ã«ã€`<Meta />`ã¯éšå±¤å†…ã®ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãªããªã‚Šã¾ã—ãŸã€‚ãƒªãƒ¼ãƒ•ãƒ«ãƒ¼ãƒˆã®`meta`ã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚é–¢æ•°å¼•æ•°ã®[`matches`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§][meta-v2-matches]ã€è¦ªãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’å«ã‚ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ã“ã®å¤‰æ›´ã«é–¢ã™ã‚‹è©³ç´°ã«ã¤ã„ã¦ã¯ã€[å…ƒã®v2 `meta`ææ¡ˆ][meta-v2-rfc]ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


[meta-v2-matches]: (link_to_matches_documentation)  <!--  ã“ã“ã«matchesã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®ãƒªãƒ³ã‚¯ã‚’æŒ¿å…¥ -->
[meta-v2-rfc]: (link_to_rfc) <!-- ã“ã“ã«RFCã¸ã®ãƒªãƒ³ã‚¯ã‚’æŒ¿å…¥ -->

#### v2 ã§ v1 ã® `meta` è¦ç´„ã‚’ä½¿ç”¨ã™ã‚‹

v1 ã®è¦ç´„ã‚’å¼•ãç¶šãä½¿ç”¨ã™ã‚‹ã«ã¯ã€`@remix-run/v1-meta` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ `meta` ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’æ›´æ–°ã§ãã¾ã™ã€‚

`metaV1` é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€`meta` é–¢æ•°ã®å¼•æ•°ã¨ã€ç¾åœ¨è¿”ã—ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€åŒã˜ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒªãƒ¼ãƒ•ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’ãã®**ç›´æ¥ã®è¦ªãƒ«ãƒ¼ãƒˆ**ã®ãƒ¡ã‚¿ã¨ãƒãƒ¼ã‚¸ã—ã¦ã‹ã‚‰ã€v2 ã§ä½¿ç”¨ã§ãã‚‹ãƒ¡ã‚¿è¨˜è¿°å­ã®é…åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export function meta() {
  return {
    title: "...",
    description: "...",
    "og:title": "...",
  };
}
```

```tsx filename=app/routes/v2-route.tsx good
import { metaV1 } from "@remix-run/v1-meta";

export function meta(args) {
  return metaV1(args, {
    title: "...",
    description: "...",
    "og:title": "...",
  });
}
```

ã“ã®é–¢æ•°ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯éšå±¤å…¨ä½“ã§ãƒ¡ã‚¿ã‚’ãƒãƒ¼ã‚¸ã—ã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€`metaV1` é–¢æ•°ã‚’ä½¿ç”¨ã›ãšã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’ç›´æ¥è¿”ã™ãƒ«ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã€äºˆæœŸã—ãªã„å‹•ä½œã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚éšå±¤å…¨ä½“ã§ãƒ¡ã‚¿ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹å ´åˆã¯ã€ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã® `meta` ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã« `metaV1` é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

#### `parentsData` å¼•æ•°

v2 ã§ã¯ã€`meta` é–¢æ•°ã¯ `parentsData` å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€`meta` ãŒ [`matches` å¼•æ•°][meta-v2-matches] ã‚’ä»‹ã—ã¦ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆãƒãƒƒãƒã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã§ã™ã€‚ã“ã‚Œã«ã¯ã€å„ãƒãƒƒãƒã®ãƒ­ãƒ¼ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

`parentsData` ã®APIã‚’è¤‡è£½ã™ã‚‹ãŸã‚ã«ã€`@remix-run/v1-meta` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ `getMatchesData` é–¢æ•°ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€å„ãƒãƒƒãƒã®ãƒ‡ãƒ¼ã‚¿ãŒãƒ«ãƒ¼ãƒˆã®IDã§ã‚­ãƒ¼ä»˜ã‘ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export function meta(args) {
  const parentData = args.parentsData["routes/parent"];
}
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
import { getMatchesData } from "@remix-run/v1-meta";

export function meta(args) {
  const matchesData = getMatchesData(args);
  const parentData = matchesData["routes/parent"];
}
```

#### æ–°ã—ã„`meta`ã¸ã®æ›´æ–°

```tsx bad filename=app/routes/v1-route.tsx
export function meta() {
  return {
    title: "...",
    description: "...",
    "og:title": "...",
  };
}
```

```tsx filename=app/routes/v2-route.tsx good
export function meta() {
  return [
    { title: "..." },
    { name: "description", content: "..." },
    { property: "og:title", content: "..." },

    // SEOé–¢é€£ã®<link>ã‚¿ã‚°ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ
    { tagName: "link", rel: "canonical", href: "..." },

    // <script type=ld+json>ã‚‚è¿½åŠ ã§ãã¾ã™
    {
      "script:ld+json": {
        some: "value",
      },
    },
  ];
}
```

#### `matches` å¼•æ•°

v1 ã§ã¯ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã‹ã‚‰è¿”ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã™ã¹ã¦ãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€v2ã§ã¯`matches` ã‚’ä½¿ç”¨ã—ã¦è‡ªåˆ†ã§ãƒãƒ¼ã‚¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
export function meta({ matches }) {
  const rootMeta = matches[0].meta;
  const title = rootMeta.find((m) => m.title);

  return [
    title,
    { name: "description", content: "..." },
    { property: "og:title", content: "..." },

    // SEO é–¢é€£ã® <link> ã‚¿ã‚°ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ
    { tagName: "link", rel: "canonical", href: "..." },

    // <script type=ld+json> ã‚‚è¿½åŠ ã§ãã¾ã™
    {
      "script:ld+json": {
        "@context": "https://schema.org",
        "@type": "Organization",
        name: "Remix",
      },
    },
  ];
}
```

[meta][meta] ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ãƒ«ãƒ¼ãƒˆãƒ¡ã‚¿ã®ãƒãƒ¼ã‚¸ã«é–¢ã™ã‚‹ã•ã‚‰ã«è©³ã—ã„ãƒ’ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚

## `CatchBoundary`ã¨`ErrorBoundary`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_errorBoundary: true,
  },
};
```

v1ã§ã¯ã€ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸ`Response`ã¯æœ€ã‚‚è¿‘ã„`CatchBoundary`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ãã®ä»–ã®æœªå‡¦ç†ã®ä¾‹å¤–ã¯ã™ã¹ã¦`ErrorBoundary`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã—ãŸã€‚v2ã§ã¯`CatchBoundary`ãŒãªããªã‚Šã€ã™ã¹ã¦ã®æœªå‡¦ç†ã®ä¾‹å¤–ã¯`ErrorBoundary`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«é–¢ã‚ã‚‰ãšåŒæ§˜ã§ã™ã€‚

ã•ã‚‰ã«ã€ã‚¨ãƒ©ãƒ¼ã¯`ErrorBoundary`ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦æ¸¡ã•ã‚Œãªããªã‚Šã€`useRouteError`ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚


```tsx bad filename=app/routes/v1-route.tsx
import { useCatch } from "@remix-run/react";

export function CatchBoundary() {
  const caught = useCatch();

  return (
    <div>
      <h1>Oops</h1>
      <p>Status: {caught.status}</p>
      <p>{caught.data.message}</p>
    </div>
  );
}

export function ErrorBoundary({ error }) {
  console.error(error);
  return (
    <div>
      <h1>Uh oh ...</h1>
      <p>Something went wrong</p>
      <pre>{error.message || "Unknown error"}</pre>
    </div>
  );
}
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
import {
  useRouteError,
  isRouteErrorResponse,
} from "@remix-run/react";

export function ErrorBoundary() {
  const error = useRouteError();

  // trueã®å ´åˆã€ã“ã‚Œã¯ä»¥å‰`CatchBoundary`ã«æ¸¡ã•ã‚Œã¦ã„ãŸã‚‚ã®ã§ã™
  if (isRouteErrorResponse(error)) {
    return (
      <div>
        <h1>Oops</h1>
        <p>Status: {error.status}</p>
        <p>{error.data.message}</p>
      </div>
    );
  }

  // ç‹¬è‡ªã®ãƒ­ã‚¸ãƒƒã‚¯ã§å‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚
  // ã‚¹ãƒ­ãƒ¼ã§ãã‚‹å€¤ã¯ã‚¨ãƒ©ãƒ¼ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼
  let errorMessage = "Unknown error";
  if (isDefinitelyAnError(error)) {
    errorMessage = error.message;
  }

  return (
    <div>
      <h1>Uh oh ...</h1>
      <p>Something went wrong.</p>
      <pre>{errorMessage}</pre>
    </div>
  );
}
```

## `formMethod`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_normalizeFormMethod: true,
  },
};
```

è¤‡æ•°ã®APIãŒã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®`formMethod`ã‚’è¿”ã—ã¾ã™ã€‚v1ã§ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã®å°æ–‡å­—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¿”ã—ã¾ã—ãŸãŒã€v2ã§ã¯å¤§æ–‡å­—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯HTTPã¨`fetch`ã®ä»•æ§˜ã«åˆã‚ã›ã‚‹ãŸã‚ã§ã™ã€‚

```tsx
function Something() {
  const navigation = useNavigation();

  // v1
  navigation.formMethod === "post";

  // v2
  navigation.formMethod === "POST";
}

export function shouldRevalidate({ formMethod }) {
  // v1
  formMethod === "post";

  // v2
  formMethod === "POST";
}
```

## `useTransition`

ã“ã®ãƒ•ãƒƒã‚¯ã¯ã€åŒã˜åå‰ã®æœ€è¿‘ã®Reactãƒ•ãƒƒã‚¯ã¨æ··åŒã‚’é¿ã‘ã‚‹ãŸã‚ã€`useNavigation` ã«åå‰ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ã¾ãŸã€`type` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã€`submission` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`navigation` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã—ãŸã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useTransition } from "@remix-run/react";

function SomeComponent() {
  const transition = useTransition();
  transition.submission.formData;
  transition.submission.formMethod;
  transition.submission.formAction;
  transition.type;
}
```

```tsx filename=app/routes/v2-route.tsx good
import { useNavigation } from "@remix-run/react";

function SomeComponent() {
  const navigation = useNavigation();

  // transition.submission ã®ã‚­ãƒ¼ã¯ `navigation[key]` ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã™
  navigation.formData;
  navigation.formMethod;
  navigation.formAction;

  // ã“ã®ã‚­ãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸ
  navigation.type;
}
```

ä»¥å‰ã®`transition.type` ã¯ã€ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«å°ãå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€é€šå¸¸ã¯`navigation.state`ã€`navigation.formData`ã€ã¾ãŸã¯`useActionData`ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€åŒã˜å‹•ä½œã‚’å®Ÿç¾ã™ã‚‹ã‚ˆã‚Šç°¡å˜ãªæ–¹æ³•ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚Discordã§è³ªå•ã—ã¦ã„ãŸã ã‘ã‚Œã°ã€å–œã‚“ã§ãŠæ‰‹ä¼ã„ã•ã›ã¦ã„ãŸã ãã¾ã™ :D

```tsx
function Component() {
  const navigation = useNavigation();

  // transition.type === "actionSubmission"
  const isActionSubmission =
    navigation.state === "submitting";

  // transition.type === "actionReload"
  const isActionReload =
    navigation.state === "loading" &&
    navigation.formMethod != null &&
    navigation.formMethod != "GET" &&
    // ã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€é€ä¿¡ã•ã‚ŒãŸå ´æ‰€ã«ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹
    navigation.formAction === navigation.location.pathname;

  // transition.type === "actionRedirect"
  const isActionRedirect =
    navigation.state === "loading" &&
    navigation.formMethod != null &&
    navigation.formMethod != "GET" &&
    // ã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€åˆ¥ã®å ´æ‰€ã«ç§»å‹•ã—ã¦ã„ã‚‹
    navigation.formAction !== navigation.location.pathname;

  // transition.type === "loaderSubmission"
  const isLoaderSubmission =
    navigation.state === "loading" &&
    navigation.state.formMethod === "GET" &&
    // ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€é€ä¿¡ã•ã‚ŒãŸå ´æ‰€ã«ç§»å‹•ã—ã¦ã„ã‚‹
    navigation.formAction === navigation.location.pathname;

  // transition.type === "loaderSubmissionRedirect"
  const isLoaderSubmissionRedirect =
    navigation.state === "loading" &&
    navigation.state.formMethod === "GET" &&
    // ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€æ–°ã—ã„å ´æ‰€ã«ç§»å‹•ã—ã¦ã„ã‚‹
    navigation.formAction !== navigation.location.pathname;
}
```

**GET ã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ã«é–¢ã™ã‚‹æ³¨æ„**

Remix v1ã§ã¯ã€`<Form method="get">`ã‚„`submit({}, { method: 'get' })`ãªã©ã®GETã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ã€`transition.state`ã§`idle -> submitting -> idle`ã¨ã„ã†çŠ¶æ…‹é·ç§»ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã€Œé€ä¿¡ã€ã—ã¦ã„ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€GETãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ï¼‰ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã¯ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã«æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚æ©Ÿèƒ½çš„ã«ã¯ã€`<Link>`ã‚„`navigate()`ã¨å¤‰ã‚ã‚Šã¾ã›ã‚“ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›å€¤ã‚’ä»‹ã—ã¦æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

v2ã§ã¯ã€GETã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ãƒ­ãƒ¼ãƒ‰ä¸­ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã‚ˆã‚Šæ­£ç¢ºã«åæ˜ ã•ã‚Œã€`navigation.state`ã‚’é€šå¸¸ã®ãƒªãƒ³ã‚¯ã®å‹•ä½œã¨åˆã‚ã›ã‚‹ãŸã‚ã«`idle -> loading -> idle`ã¨ã„ã†çŠ¶æ…‹é·ç§»ã‚’ã—ã¾ã™ã€‚GETã‚µãƒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒ`<Form>`ã¾ãŸã¯`submit()`ã‹ã‚‰æ¥ãŸå ´åˆã€`useNavigation.form*`ãŒè¨­å®šã•ã‚Œã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦åŒºåˆ¥ã§ãã¾ã™ã€‚

## `useFetcher`

`useNavigation`ã¨åŒæ§˜ã«ã€`useFetcher`ã¯`submission`ã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã—ã€`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useFetcher } from "@remix-run/react";

function SomeComponent() {
  const fetcher = useFetcher();
  fetcher.submission.formData;
  fetcher.submission.formMethod;
  fetcher.submission.formAction;
  fetcher.type;
}
```

```tsx filename=app/routes/v2-route.tsx good
import { useFetcher } from "@remix-run/react";

function SomeComponent() {
  const fetcher = useFetcher();

  // ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã¯ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¦ã„ã¾ã™
  fetcher.formData;
  fetcher.formMethod;
  fetcher.formAction;

  // ã“ã®ã‚­ãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸ
  fetcher.type;
}
```

ä»¥å‰ã®`fetcher.type`ã¯ã€ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«å°ãå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€é€šå¸¸ã¯`fetcher.state`ã€`fetcher.formData`ã€ã¾ãŸã¯`fetcher.data`ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§åŒã˜å‹•ä½œã‚’å®Ÿç¾ã§ãã‚‹ã€ã‚ˆã‚Šç°¡å˜ãªæ–¹æ³•ãŒã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚Discordã§è³ªå•ã—ã¦ã„ãŸã ã‘ã‚Œã°ã€å–œã‚“ã§ãŠæ‰‹ä¼ã„ã•ã›ã¦ã„ãŸã ãã¾ã™ :D

```tsx
function Component() {
  const fetcher = useFetcher();

  // fetcher.type === "init"
  const isInit =
    fetcher.state === "idle" && fetcher.data == null;

  // fetcher.type === "done"
  const isDone =
    fetcher.state === "idle" && fetcher.data != null;

  // fetcher.type === "actionSubmission"
  const isActionSubmission = fetcher.state === "submitting";

  // fetcher.type === "actionReload"
  const isActionReload =
    fetcher.state === "loading" &&
    fetcher.formMethod != null &&
    fetcher.formMethod != "GET" &&
    // ãƒ‡ãƒ¼ã‚¿ãŒè¿”ã•ã‚ŒãŸå ´åˆã€ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
    fetcher.data != null;

  // fetcher.type === "actionRedirect"
  const isActionRedirect =
    fetcher.state === "loading" &&
    fetcher.formMethod != null &&
    fetcher.formMethod != "GET" &&
    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
    fetcher.data == null;

  // fetcher.type === "loaderSubmission"
  const isLoaderSubmission =
    fetcher.state === "loading" &&
    fetcher.formMethod === "GET";

  // fetcher.type === "normalLoad"
  const isNormalLoad =
    fetcher.state === "loading" &&
    fetcher.formMethod == null;
}
```

**GETé€ä¿¡ã«é–¢ã™ã‚‹æ³¨æ„**

Remix v1ã§ã¯ã€`<fetcher.Form method="get">`ã‚„`fetcher.submit({}, { method: 'get' })`ãªã©ã®GETé€ä¿¡ã¯ã€`fetcher.state`ã§`idle -> submitting -> idle`ã¨ãªã£ã¦ã„ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã€Œé€ä¿¡ã€ã—ã¦ã„ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ï¼‰ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã¯ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã«å®Œå…¨ã«æ­£ç¢ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ©Ÿèƒ½çš„ã«ã¯`fetcher.load()`ã¨å¤‰ã‚ã‚Šã¾ã›ã‚“ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›å€¤ã‚’ä»‹ã—ã¦æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

v2ã§ã¯ã€GETé€ä¿¡ã¯ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦ã‚ˆã‚Šæ­£ç¢ºã«åæ˜ ã•ã‚Œã‚‹ãŸã‚ã€`fetcher.state`ã‚’é€šå¸¸ã®fetcherãƒ­ãƒ¼ãƒ‰ã®å‹•ä½œã¨åˆã‚ã›ã‚‹ãŸã‚ã«`idle -> loading -> idle`ã¨ãªã‚Šã¾ã™ã€‚GETé€ä¿¡ãŒ`<fetcher.Form>`ã¾ãŸã¯`fetcher.submit()`ã‹ã‚‰ã®ã‚‚ã®ã§ã‚ã‚‹å ´åˆã€`fetcher.form*`ãŒè¨­å®šã•ã‚Œã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦åŒºåˆ¥ã§ãã¾ã™ã€‚

## ãƒªãƒ³ã‚¯ `imagesizes` ã¨ `imagesrcset`

ãƒ«ãƒ¼ãƒˆã® `links` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€HTMLã®å°æ–‡å­—å€¤ã§ã¯ãªãã€ã™ã¹ã¦Reactã®ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹å€¤ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®2ã¤ã®å€¤ã¯v1ã§å°æ–‡å­—ã¨ã—ã¦ç´›ã‚Œè¾¼ã‚“ã§ã„ã¾ã—ãŸã€‚v2ã§ã¯ã€ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿ãŒæœ‰åŠ¹ã§ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export const links: LinksFunction = () => {
  return [
    {
      rel: "preload",
      as: "image",
      imagesrcset: "...",
      imagesizes: "...",
    },
  ];
};
```

```tsx filename=app/routes/v2-route.tsx good
export const links: V2_LinksFunction = () => {
  return [
    {
      rel: "preload",
      as: "image",
      imageSrcSet: "...",
      imageSizes: "...",
    },
  ];
};
```

## `browserBuildDirectory`

`remix.config.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«ãŠã„ã¦ã€`browserBuildDirectory`ã‚’`assetsBuildDirectory`ã«åå‰å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```javascript bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserBuildDirectory: "./public/build",
};
```

```javascript filename=remix.config.js good lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  assetsBuildDirectory: "./public/build",
};
```

## `devServerBroadcastDelay`

`remix.config.js` ã‹ã‚‰ `devServerBroadcastDelay` ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã ã£ãŸç«¶åˆçŠ¶æ…‹ã¯ã€v2 ã¾ãŸã¯ `v2_dev` ã§è§£æ¶ˆã•ã‚Œã¾ã—ãŸã€‚

```diff filename=remix.config.js
  /** @type {import('@remix-run/dev').AppConfig} */
  module.exports = {
-   devServerBroadcastDelay: 300,
  };
```

## `devServerPort`

`remix.config.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«ãŠã„ã¦ã€`devServerPort`ã‚’`future.v2_dev.port`ã«åå‰ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```javascript bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  devServerPort: 8002,
};
```

```javascript filename=remix.config.js good lines=[3-7]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  // v1.x ã®é–“ã¯ã€future ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¾ã™
  future: {
    v2_dev: {
      port: 8002,
    },
  },
};
```

v1ã‹ã‚‰v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ã“ã‚Œã¯[ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®`dev`è¨­å®š][dev-after-upgrading]ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã™ã€‚


[dev-after-upgrading]:  (This needs a URL or further context to translate accurately.  Please provide the link target.)

## `serverBuildDirectory`

`remix.config.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«ãŠã„ã¦ã€`serverBuildDirectory`ã‚’`serverBuildPath`ã«åå‰å¤‰æ›´ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ãªãã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

```javascript bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverBuildDirectory: "./build",
};
```

```javascript filename=remix.config.js good lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverBuildPath: "./build/index.js",
};
```

Remixã¯ä»¥å‰ã€ã‚µãƒ¼ãƒãƒ¼ç”¨ã«è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## `serverBuildTarget`

ãƒ“ãƒ«ãƒ‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹ä»£ã‚ã‚Šã«ã€[`remix.config.js`][remix_config] ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒæœŸå¾…ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ“ãƒ«ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€Remixã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒãã‚Œã‚‰ã‚’çŸ¥ã‚‹å¿…è¦ãªãã€Remixã‚’ã‚ˆã‚Šå¤šãã®JavaScriptãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ã‚µãƒ¼ãƒãƒ¼ã€ãŠã‚ˆã³ãƒ›ã‚¹ãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ç¾åœ¨ã®`serverBuildTarget`ã‚’ç½®ãæ›ãˆã‚‹ã¹ãè¨­å®šã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

#### `arc`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/_static/build/",
  serverBuildPath: "server/index.js",
  serverMainFields: ["main", "module"], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverModuleFormat: "cjs", // 1.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«è¿½åŠ 
  serverPlatform: "node", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
};
```

#### `cloudflare-pages`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverBuildPath: "functions/[[path]].js",
  serverConditions: ["worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["browser", "module", "main"],
  serverMinify: true,
  serverModuleFormat: "esm", // 2.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã‚‰å‰Šé™¤ã§ãã¾ã™
  serverPlatform: "neutral",
};
```

#### `cloudflare-workers`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverConditions: ["worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["browser", "module", "main"],
  serverMinify: true,
  serverModuleFormat: "esm", // 2.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã‚‰å‰Šé™¤ã§ãã¾ã™
  serverPlatform: "neutral",
};
```

#### `deno`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverConditions: ["deno", "worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["module", "main"],
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverModuleFormat: "esm", // 2.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸã‚‰å‰Šé™¤ã§ãã¾ã™
  serverPlatform: "neutral",
};
```

#### `node-cjs`

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverMainFields: ["main", "module"], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
  serverModuleFormat: "cjs", // 1.xã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«è¿½åŠ 
  serverPlatform: "node", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤ã§ãã¾ã™
};
```

## `serverModuleFormat`

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚µãƒ¼ãƒãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‡ºåŠ›å½¢å¼ãŒ `cjs` ã‹ã‚‰ `esm` ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚v2 ã§ã‚‚å¼•ãç¶šã CJS ã‚’ä½¿ç”¨ã§ãã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®å¤šãã®ä¾å­˜é–¢ä¿‚ãŒ ESM ã¨äº’æ›æ€§ãŒãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

`remix.config.js` ã§ã¯ã€æ—¢å­˜ã®å‹•ä½œã‚’ç¶­æŒã™ã‚‹ã«ã¯ `serverModuleFormat: "cjs"` ã‚’ã€æ–°ã—ã„å‹•ä½œã‚’é¸æŠã™ã‚‹ã«ã¯ `serverModuleFormat: "esm"` ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## `browserNodeBuiltinsPolyfill`

Node.jsçµ„ã¿è¾¼ã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒªãƒ•ã‚£ãƒ«ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§æä¾›ã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚Remix v2ã§ã¯ã€å¿…è¦ã«å¿œã˜ã¦ãƒãƒªãƒ•ã‚£ãƒ«ï¼ˆã¾ãŸã¯ç©ºã®ãƒãƒªãƒ•ã‚£ãƒ«ï¼‰ã‚’æ˜ç¤ºçš„ã«å†å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserNodeBuiltinsPolyfill: {
    modules: {
      buffer: true,
      fs: "empty",
    },
    globals: {
      Buffer: true,
    },
  },
};
```

ä¸€éƒ¨ã®ãƒãƒªãƒ•ã‚£ãƒ«ã¯éå¸¸ã«å¤§ãããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒ³ãƒ‰ãƒ«ã§è¨±å¯ã•ã‚Œã‚‹ãƒãƒªãƒ•ã‚£ãƒ«ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ãŒã€æ¬¡ã®è¨­å®šã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Remix v1ã‹ã‚‰ã®å®Œå…¨ãªãƒãƒªãƒ•ã‚£ãƒ«ã‚»ãƒƒãƒˆã‚’ç°¡å˜ã«å¾©å…ƒã§ãã¾ã™ã€‚

```javascript filename=remix.config.js
const { builtinModules } = require("node:module");

/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserNodeBuiltinsPolyfill: {
    modules: builtinModules,
  },
};
```

## `serverNodeBuiltinsPolyfill`

Node.jsçµ„ã¿è¾¼ã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒªãƒ•ã‚£ãƒ«ã¯ã€Node.jsä»¥å¤–ã®ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æä¾›ã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚

Node.jsä»¥å¤–ã®ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¦ãŠã‚Šã€v1ã®æ–°ã—ã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã‚’æ¡ç”¨ã—ãŸã„å ´åˆã¯ã€`remix.config.js`ã§`serverNodeBuiltinsPolyfill.modules`ã«ç©ºã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ã€ã™ã¹ã¦ã®ã‚µãƒ¼ãƒãƒ¼ãƒãƒªãƒ•ã‚£ãƒ«ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverNodeBuiltinsPolyfill: {
    modules: {},
  },
};
```

ãã®å¾Œã€å¿…è¦ã«å¿œã˜ã¦ãƒãƒªãƒ•ã‚£ãƒ«ï¼ˆã¾ãŸã¯ç©ºã®ãƒãƒªãƒ•ã‚£ãƒ«ï¼‰ã‚’å†å°å…¥ã§ãã¾ã™ã€‚

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverNodeBuiltinsPolyfill: {
    modules: {
      buffer: true,
      fs: "empty",
    },
    globals: {
      Buffer: true,
    },
  },
};
```

å‚è€ƒã¨ã—ã¦ã€v1ã‹ã‚‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒªãƒ•ã‚£ãƒ«ã®å®Œå…¨ãªã‚»ãƒƒãƒˆã‚’æ‰‹å‹•ã§æŒ‡å®šã™ã‚‹æ–¹æ³•ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

```javascript filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverNodeBuiltinsPolyfill: {
    modules: {
      _stream_duplex: true,
      _stream_passthrough: true,
      _stream_readable: true,
      _stream_transform: true,
      _stream_writable: true,
      assert: true,
      "assert/strict": true,
      buffer: true,
      console: true,
      constants: true,
      crypto: "empty",
      diagnostics_channel: true,
      domain: true,
      events: true,
      fs: "empty",
      "fs/promises": "empty",
      http: true,
      https: true,
      module: true,
      os: true,
      path: true,
      "path/posix": true,
      "path/win32": true,
      perf_hooks: true,
      process: true,
      punycode: true,
      querystring: true,
      stream: true,
      "stream/promises": true,
      "stream/web": true,
      string_decoder: true,
      sys: true,
      timers: true,
      "timers/promises": true,
      tty: true,
      url: true,
      util: true,
      "util/types": true,
      vm: true,
      wasi: true,
      worker_threads: true,
      zlib: true,
    },
  },
};
```

## `installGlobals`

Nodeçµ„ã¿è¾¼ã¿ã®fetchå®Ÿè£…ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®æº–å‚™ã¨ã—ã¦ã€fetchã‚°ãƒ­ãƒ¼ãƒãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ç¾åœ¨ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã®è²¬ä»»ã¨ãªã£ã¦ã„ã¾ã™ã€‚`remix-serve`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä½•ã‚‚ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€è‡ªåˆ†ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```ts filename=server.ts
import { installGlobals } from "@remix-run/node";

installGlobals();
```

### ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒãƒªãƒ•ã‚£ãƒ«ã®å‰Šé™¤

Remix v2ã§ã¯ã€`@remix-run/node`ã‹ã‚‰ã“ã‚Œã‚‰ã®ãƒãƒªãƒ•ã‚£ãƒ«å®Ÿè£…ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãªããªã‚Šã¾ã—ãŸã€‚ä»£ã‚ã‚Šã«ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã«ã‚ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å¤‰æ›´ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„å ´æ‰€ã®1ã¤ã¯ã€`app/entry.server.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã“ã“ã§ã¯ã€Nodeã®[`PassThrough`][pass_through_class]ã‚’Webã®[`ReadableStream`][readable_stream]ã«`createReadableStreamFromReadable`ã‚’ä½¿ç”¨ã—ã¦å¤‰æ›ã™ã‚‹å¿…è¦ã‚‚ã‚ã‚Šã¾ã™ã€‚

```diff filename=app/entry.server.tsx
  import { PassThrough } from "node:stream";
  import type { AppLoadContext, EntryContext } from "@remix-run/node"; // or cloudflare/deno
- import { Response } from "@remix-run/node"; // or cloudflare/deno
+ import { createReadableStreamFromReadable } from "@remix-run/node"; // or cloudflare/deno
  import { RemixServer } from "@remix-run/react";
  import { isbot } from "isbot";
  import { renderToPipeableStream } from "react-dom/server";

  const ABORT_DELAY = 5_000;

  export default function handleRequest({ /* ... */ }) { ... }

  function handleBotRequest(...) {
    return new Promise((resolve, reject) => {
      let shellRendered = false;
      const { pipe, abort } = renderToPipeableStream(
        <RemixServer ... />,
        {
          onAllReady() {
            shellRendered = true;
            const body = new PassThrough();

            responseHeaders.set("Content-Type", "text/html");

            resolve(
-             new Response(body, {
+             new Response(createReadableStreamFromReadable(body), {
                headers: responseHeaders,
                status: responseStatusCode,
              })
            );

            pipe(body);
          },
          ...
          onShellError(error: unknown) { ... }
          onError(error: unknown) { ... }
        }
      );

      setTimeout(abort, ABORT_DELAY);
    });
  }

  function handleBrowserRequest(...) {
    return new Promise((resolve, reject) => {
      let shellRendered = false;
      const { pipe, abort } = renderToPipeableStream(
        <RemixServer ... />,
        {
          onShellReady() {
            shellRendered = true;
            const body = new PassThrough();

            responseHeaders.set("Content-Type", "text/html");

            resolve(
-              new Response(body, {
+              new Response(createReadableStreamFromReadable(body), {
                headers: responseHeaders,
                status: responseStatusCode,
              })
            );

            pipe(body);
          },
          onShellError(error: unknown) { ... },
          onError(error: unknown) { ... },
        }
      );

      setTimeout(abort, ABORT_DELAY);
    });
  }
```

## `source-map-support`

ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã®ã‚µãƒãƒ¼ãƒˆã¯ã€ç¾åœ¨ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã®è²¬ä»»ã§ã™ã€‚`remix-serve` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä½•ã‚‚å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€[`source-map-support`][source-map-support] ã‚’è‡ªåˆ†ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shellscript nonumber
npm i source-map-support
```

```ts filename=server.ts
import sourceMapSupport from "source-map-support";

sourceMapSupport.install();
```

## Netlify ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼

`@remix-run/netlify` ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ã€[`@netlify/remix-adapter`][official-netlify-adapter] ã¨ [`@netlify/remix-edge-adapter`][official-netlify-edge-adapter] ã«ç½®ãæ›ãˆã‚‰ã‚ŒãŸãŸã‚ã€Remix v2 ã‹ã‚‰å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚`@remix-run/netlify` ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ `@netlify/remix-adapter` ã«å¤‰æ›´ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

`@netlify/remix-adapter` ã¯ `@netlify/functions@^1.0.0` ã‚’å¿…è¦ã¨ã™ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€`@remix-run/netlify` ã§ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ `@netlify/functions` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨æ¯”è¼ƒã—ã¦ç ´å£Šçš„å¤‰æ›´ã§ã™ã€‚

ã“ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å‰Šé™¤ã«ä¼´ã„ã€[Netlify ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][netlify-template] ã‚‚å‰Šé™¤ã•ã‚Œã€[å…¬å¼Netlifyãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][official-netlify-template] ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚


[official-netlify-adapter]: <official-netlify-adapter-link>
[official-netlify-edge-adapter]: <official-netlify-edge-adapter-link>
[netlify-template]: <netlify-template-link>
[official-netlify-template]: <official-netlify-template-link>

## Vercel ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼

`@remix-run/vercel` ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ã€Vercel ã®æ¨™æº–æ©Ÿèƒ½ã«ç½®ãæ›ãˆã‚‰ã‚ŒãŸãŸã‚ã€Remix v2 ã‚ˆã‚Šå»ƒæ­¢ã•ã‚Œã€å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚`package.json` ã‹ã‚‰ `@remix-run/vercel` ã¨ `@vercel/node` ã‚’å‰Šé™¤ã—ã€`server.js`/`server.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã€`remix.config.js` ã‹ã‚‰ `server` ã¨ `serverBuildPath` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚

ã“ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å‰Šé™¤ã«ä¼´ã„ã€[Vercel ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][vercel-template] ã‚‚å‰Šé™¤ã•ã‚Œã€[å…¬å¼ Vercel ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][official-vercel-template] ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚


[vercel-template]: <vercel-template-link>  // vercel-templateã¸ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥
[official-vercel-template]: <official-vercel-template-link> // official-vercel-templateã¸ã®ãƒªãƒ³ã‚¯ã‚’ã“ã“ã«æŒ¿å…¥

## çµ„ã¿è¾¼ã¿PostCSS/Tailwindã‚µãƒãƒ¼ãƒˆ

v2ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«PostCSSã¨/ã¾ãŸã¯Tailwindã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¯Remixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å†…ã§è‡ªå‹•çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

v2ã¸ã®ç§»è¡Œæ™‚ã«ã€Remixä»¥å¤–ã§ã‚«ã‚¹ã‚¿ãƒ PostCSSã¨/ã¾ãŸã¯Tailwindã®è¨­å®šã‚’ç¶­æŒã—ãŸã„å ´åˆã¯ã€`remix.config.js`ã§ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’ç„¡åŠ¹ã«ã§ãã¾ã™ã€‚

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  postcss: false,
  tailwind: false,
};
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ESM/CommonJS ã‚¨ãƒ©ãƒ¼

```sh
"SyntaxError: Named export '<something>' not found. The requested module '<something>' is a CommonJS module, which may not support all module.exports as named exports."
```

[`serverModuleFormat`][server-module-format] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[classic-remix-compiler]: ../guides/vite#classic-remix-compiler-vs-remix-vite

[remix-vite]: ../guides/vite

[future-flags]: ./future-flags

[remix_config]: ../file-conventions/remix-config

[pass_through_class]: https://nodejs.org/api/stream.html#class-streampassthrough

[readable_stream]: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream

[flat-routes]: https://github.com/remix-run/remix/discussions/4482

[meta]: ../route/meta

[meta-v2-rfc]: https://github.com/remix-run/remix/discussions/4462

[meta-v2-matches]: #the-matches-argument

[templates]: https://github.com/remix-run/remix/tree/main/templates

[dev-docs]: ../other-api/dev

[manual-mode]: ../guides/manual-mode

[source-map-support]: https://npm.im/source-map-support

[official-netlify-adapter]: https://github.com/netlify/remix-compute/tree/main/packages/remix-adapter

[official-netlify-edge-adapter]: https://github.com/netlify/remix-compute/tree/main/packages/remix-edge-adapter

[netlify-template]: https://github.com/remix-run/remix/tree/main/templates/netlify

[official-netlify-template]: https://github.com/netlify/remix-template

[vercel-template]: https://github.com/remix-run/remix/tree/main/templates/vercel

[official-vercel-template]: https://github.com/vercel/vercel/tree/main/examples/remix

[troubleshooting]: #troubleshooting

[server-module-format]: #servermoduleformat

[2-min-to-v2]: https://twitter.com/BrooksLybrand/status/1704265835546578989

[dev-after-upgrading]: #after-upgrading-from-v1-to-v2

