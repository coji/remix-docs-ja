---
title: v2 ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
order: 3
---

# v2 ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

<docs-warning>ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€[å¾“æ¥ã® Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©][classic-remix-compiler] ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã€v1 ã‹ã‚‰ v2 ã¸ã®ç§»è¡Œã«é–¢ã™ã‚‹ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚Vite ã¸ã®ç§»è¡Œã«é–¢ã™ã‚‹è¿½åŠ ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ã€[Remix Vite ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ][remix-vite] ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</docs-warning>

v2 ã®ã™ã¹ã¦ã® API ã¨å‹•ä½œã¯ã€[Future Flags][future-flags] ã‚’ä½¿ç”¨ã—ã¦ v1 ã§åˆ©ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã¯é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­æ–­ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€ä¸€åº¦ã« 1 ã¤ãšã¤æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã™ã¹ã¦ã®ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã—ãŸã‚‰ã€v2 ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¯ã€éç ´å£Šçš„ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°][troubleshooting] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ä¸€èˆ¬çš„ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å•é¡Œã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¦ã‚©ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼ã«ã¤ã„ã¦ã¯ã€[ğŸ¥ 2 åˆ†ã§ v2][2-min-to-v2] ã‚’ã”è¦§ãã ã•ã„ã€‚

## `remix dev`

æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€[`remix dev` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ][dev-docs] ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### `remix-serve`

Remix App Server (`remix-serve`) ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€`v2_dev` ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_dev: true,
  },
};
```

ä»¥ä¸Šã§ã™ï¼

### ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼

ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ (`server.js`) ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€
`v2_dev` ã¨ã®çµ±åˆæ–¹æ³•ã®ä¾‹ã«ã¤ã„ã¦ã¯ã€[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][templates] ã‚’ç¢ºèªã™ã‚‹ã‹ã€æ¬¡ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚

1. `v2_dev` ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚

   ```js filename=remix.config.js
   /** @type {import('@remix-run/dev').AppConfig} */
   module.exports = {
     future: {
       v2_dev: true,
     },
   };
   ```

2. `package.json` ã® `scripts` ã‚’æ›´æ–°ã™ã‚‹ã€‚

   - ã™ã¹ã¦ã® `remix watch` ã‚’ `remix dev` ã«ç½®ãæ›ãˆã‚‹ã€‚
   - å†—é•·ãª `NODE_ENV=development` ã‚’å‰Šé™¤ã™ã‚‹ã€‚
   - `-c` / `--command` ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

   ä¾‹ï¼š

   ```diff filename=package.json
    {
      "scripts": {
   -    "dev:remix": "cross-env NODE_ENV=development remix watch",
   -    "dev:server": "cross-env NODE_ENV=development node ./server.js"
   +    "dev": "remix dev -c 'node ./server.js'",
      }
    }
   ```

3. ã‚¢ãƒ—ãƒªãŒå®Ÿè¡Œã•ã‚ŒãŸã‚‰ã€Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã« "ready" ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã€‚

   ```ts filename=server.js lines=[1-2,11]
   import { broadcastDevReady } from "@remix-run/node";
   // import { logDevReady } from "@remix-run/cloudflare" // CloudFlare ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ `logDevReady` ã‚’ä½¿ç”¨ã—ã¾ã™

   const BUILD_DIR = path.join(process.cwd(), "build");

   // ... ã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®šã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«è¨˜è¿° ...

   const port = 3000;
   app.listen(port, async () => {
     console.log(`ğŸ‘‰ http://localhost:${port}`);
     broadcastDevReady(await import(BUILD_DIR));
   });
   ```

4. (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) `--manual`

   `require` ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ¶ˆå»ã«ä¾å­˜ã—ã¦ã„ãŸå ´åˆã¯ã€`--manual` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å¼•ãç¶šãæ¶ˆå»ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

   ```shellscript nonumber
   remix dev --manual -c 'node ./server.js'
   ```

   è©³ç´°ã«ã¤ã„ã¦ã¯ã€[ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰][manual-mode] ã‚’ã”è¦§ãã ã•ã„ã€‚

### v1 ã‹ã‚‰ v2 ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œ

v1 ã§ `future.v2_dev` ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦æ­£å¸¸ã«å‹•ä½œã—ãŸã‚‰ã€v2 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸã€‚
`v2_dev` ãŒ `true` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã ã‘ã®å ´åˆã€å‰Šé™¤ã—ã¦ã‚‚å•é¡Œãªãå‹•ä½œã—ã¾ã™ã€‚

`v2_dev` æ§‹æˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€`dev` æ§‹æˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff filename=remix.config.js
  /** @type {import('@remix-run/dev').AppConfig} */
  module.exports = {
-   future: {
-     v2_dev: {
-       port: 4004
-     }
-   }
+   dev: {
+     port: 4004
+   }
  }
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ«ãƒ¼ãƒˆè¦å‰‡

#### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã›ãšã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹

v2 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸå¾Œã‚‚ã€æ–°ã—ã„è¦å‰‡ã«å¤‰æ›´ã—ãŸããªã„å ´åˆï¼ˆã¾ãŸã¯ã€ã“ã‚Œã¯å˜ãªã‚‹è¦å‰‡ã§ã‚ã‚Šã€å¥½ã¿ã«å¿œã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆã‚’ä½¿ç”¨ã§ãã¾ã™ï¼‰ã€`@remix-run/v1-route-convention` ã‚’ä½¿ç”¨ã—ã¦å¤ã„è¦å‰‡ã‚’å¼•ãç¶šãä½¿ç”¨ã§ãã¾ã™ã€‚

```shellscript nonumber
npm i -D @remix-run/v1-route-convention
```

```js filename=remix.config.js
const {
  createRoutesFromFolders,
} = require("@remix-run/v1-route-convention");

/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    // v1.15 ä»¥é™ã§ã¯ã€è­¦å‘Šã‚’æ¶ˆå»ã—ã¾ã™
    v2_routeConvention: true,
  },

  routes(defineRoutes) {
    // v1 ã®è¦å‰‡ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚v1.15 ä»¥é™ã¨ v2 ã§å‹•ä½œã—ã¾ã™ã€‚
    return createRoutesFromFolders(defineRoutes);
  },
};
```

#### æ–°ã—ã„è¦å‰‡ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹

- ãƒ«ãƒ¼ãƒˆã®ãƒã‚¹ãƒˆã¯ã€ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒã‚¹ãƒˆã§ã¯ãªãã€ãƒ•ã‚¡ã‚¤ãƒ«åå†…ã®ãƒ‰ãƒƒãƒˆ (`.`) ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã® `suffixed_` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã¯ã€ãƒ‰ãƒƒãƒˆ (`.`) ã§ã¯ãªãã€å¯èƒ½æ€§ã®ã‚ã‚‹ä¸€è‡´ã™ã‚‹è¦ªãƒ«ãƒ¼ãƒˆã¨ã®ãƒã‚¹ãƒˆã‚’ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã® `_prefixed` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã¯ã€`__double` ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§ã¯ãªãã€ãƒ‘ã‚¹ãªã—ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
- `_index.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`index.tsx` ã§ã¯ãªãã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

v1 ã§ã“ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚

```text bad
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __auth/
â”‚   â”‚   â”œâ”€â”€ login.tsx
â”‚   â”‚   â”œâ”€â”€ logout.tsx
â”‚   â”‚   â””â”€â”€ signup.tsx
â”‚   â”œâ”€â”€ __public/
â”‚   â”‚   â”œâ”€â”€ about-us.tsx
â”‚   â”‚   â”œâ”€â”€ contact.tsx
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ calendar/
â”‚   â”‚   â”‚   â”œâ”€â”€ $day.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â”œâ”€â”€ $projectId/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ collaborators.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ edit.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tasks.$taskId.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ $projectId.tsx
â”‚   â”‚   â”‚   â””â”€â”€ new.tsx
â”‚   â”‚   â”œâ”€â”€ calendar.tsx
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ projects.tsx
â”‚   â”œâ”€â”€ __auth.tsx
â”‚   â”œâ”€â”€ __public.tsx
â”‚   â””â”€â”€ dashboard.projects.$projectId.print.tsx
â””â”€â”€ root.tsx
```

`v2_routeConvention` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```text good
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _auth.login.tsx
â”‚   â”œâ”€â”€ _auth.logout.tsx
â”‚   â”œâ”€â”€ _auth.signup.tsx
â”‚   â”œâ”€â”€ _auth.tsx
â”‚   â”œâ”€â”€ _public._index.tsx
â”‚   â”œâ”€â”€ _public.about-us.tsx
â”‚   â”œâ”€â”€ _public.contact.tsx
â”‚   â”œâ”€â”€ _public.tsx
â”‚   â”œâ”€â”€ dashboard._index.tsx
â”‚   â”œâ”€â”€ dashboard.calendar._index.tsx
â”‚   â”œâ”€â”€ dashboard.calendar.$day.tsx
â”‚   â”œâ”€â”€ dashboard.calendar.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId._index.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.collaborators.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.edit.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.settings.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.tasks.$taskId.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.tsx
â”‚   â”œâ”€â”€ dashboard.projects.new.tsx
â”‚   â”œâ”€â”€ dashboard.projects.tsx
â”‚   â””â”€â”€ dashboard_.projects.$projectId.print.tsx
â””â”€â”€ root.tsx
```

è¦ªãƒ«ãƒ¼ãƒˆã¯ã€æ•°åã®ãƒ«ãƒ¼ãƒˆã§åŒºåˆ‡ã‚‰ã‚Œã‚‹ã®ã§ã¯ãªãã€ä¸€ç·’ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆèªè¨¼ãƒ«ãƒ¼ãƒˆãªã©ï¼‰ã€‚ãƒ‘ã‚¹ã¯åŒã˜ã ãŒã€ãƒã‚¹ãƒˆãŒç•°ãªã‚‹ãƒ«ãƒ¼ãƒˆï¼ˆ`dashboard` ã¨ `dashboard_` ãªã©ï¼‰ã‚‚ä¸€ç·’ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã¾ã™ã€‚

æ–°ã—ã„è¦å‰‡ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã¯ã™ã¹ã¦ã€å†…éƒ¨ã« `route.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã™ã‚‹ã“ã¨ãŒã§ãã€ãã“ã§ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®šç¾©ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒˆã«é…ç½®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãŸã¨ãˆã°ã€`_public.tsx` ã‚’ `_public/route.tsx` ã«ç§»å‹•ã—ã€ãƒ«ãƒ¼ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åŒã˜å ´æ‰€ã«é…ç½®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```text
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _auth.tsx
â”‚   â”œâ”€â”€ _public/
â”‚   â”‚   â”œâ”€â”€ footer.tsx
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â””â”€â”€ route.tsx
â”‚   â”œâ”€â”€ _public._index.tsx
â”‚   â”œâ”€â”€ _public.about-us.tsx
â”‚   â””â”€â”€ etc.
â””â”€â”€ root.tsx
```

ã“ã®å¤‰æ›´ã«é–¢ã™ã‚‹è©³ã—ã„èƒŒæ™¯ã«ã¤ã„ã¦ã¯ã€[å…ƒã®ã€Œãƒ•ãƒ©ãƒƒãƒˆãƒ«ãƒ¼ãƒˆã€ææ¡ˆ][flat-routes] ã‚’ã”è¦§ãã ã•ã„ã€‚

## ãƒ«ãƒ¼ãƒˆã® `headers`

Remix v2 ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã® `headers` é–¢æ•°ã®å‹•ä½œãŒã‚ãšã‹ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚`remix.config.js` ã® `future.v2_headers` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦ã€ã“ã®æ–°ã—ã„å‹•ä½œã‚’äº‹å‰ã«ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã§ãã¾ã™ã€‚

v1 ã§ã¯ã€Remix ã¯ãƒªãƒ¼ãƒ•ãƒ¬ãƒ™ãƒ«ã® "ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸ" ãƒ«ãƒ¼ãƒˆã® `headers` é–¢æ•°ã®çµæœã®ã¿ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚ã™ã¹ã¦ã®å¯èƒ½æ€§ã®ã‚ã‚‹ãƒªãƒ¼ãƒ•ãƒ¬ãƒ™ãƒ«ã« `headers` é–¢æ•°ã‚’è¿½åŠ ã—ã€ãã‚Œã«å¿œã˜ã¦ `parentHeaders` ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ã“ã¨ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è²¬ä»»ã§ã—ãŸã€‚ã“ã‚Œã¯ã€éå¸¸ã«ã™ãã«é¢å€’ã«ãªã‚Šã€æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ã—ãŸã¨ãã« `headers` é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œã¦ã—ã¾ã†ã“ã¨ã‚‚ç°¡å˜ã§ã™ã€‚ã“ã‚Œã¯ã€è¦ªã¨åŒã˜ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å…±æœ‰ã—ãŸã„å ´åˆã§ã‚‚åŒæ§˜ã§ã™ã€‚

v2 ã§ã¯ã€Remix ã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆå†…ã§æœ€ã‚‚æ·±ã„ `headers` é–¢æ•°ã‚’ç¾åœ¨ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å…±é€šã®ç¥–å…ˆã‹ã‚‰ãƒ«ãƒ¼ãƒˆé–“ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç°¡å˜ã«å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ã€ç‰¹å®šã®å‹•ä½œãŒå¿…è¦ãªå ´åˆã¯ã€ã‚ˆã‚Šæ·±ã„ãƒ«ãƒ¼ãƒˆã« `headers` é–¢æ•°ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

## ãƒ«ãƒ¼ãƒˆã® `meta`

Remix v2 ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã® `meta` é–¢æ•°ã®ç½²åã¨ã€Remix ãŒå†…éƒ¨ã§ãƒ¡ã‚¿ã‚¿ã‚°ã‚’å‡¦ç†ã™ã‚‹æ–¹æ³•ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

`meta` ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™ä»£ã‚ã‚Šã«ã€è¨˜è¿°å­ã®é…åˆ—ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã€ãƒãƒ¼ã‚¸ã‚’è‡ªåˆ†ã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`meta` API ã¯ `links` ã«ã‚ˆã‚Šè¿‘ã¥ãã€ãƒ¡ã‚¿ã‚¿ã‚°ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ–¹æ³•ã«ã¤ã„ã¦ã€ã‚ˆã‚ŠæŸ”è»Ÿæ€§ã¨åˆ¶å¾¡åŠ›ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€`<Meta />` ã¯ã€éšå±¤å†…ã®ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãªããªã‚Šã¾ã—ãŸã€‚ãƒªãƒ¼ãƒ•ãƒ¬ãƒ™ãƒ«ã®ãƒ«ãƒ¼ãƒˆã‹ã‚‰ `meta` ã§è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚[é–¢æ•°ã®å¼•æ•°ã§ `matches` ã«ã‚¢ã‚¯ã‚»ã‚¹][meta-v2-matches] ã—ã¦ã€è¦ªãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’å«ã‚ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ã“ã®å¤‰æ›´ã«é–¢ã™ã‚‹è©³ã—ã„èƒŒæ™¯ã«ã¤ã„ã¦ã¯ã€[å…ƒã® v2 ã® `meta` ææ¡ˆ][meta-v2-rfc] ã‚’ã”è¦§ãã ã•ã„ã€‚

#### v2 ã§ v1 ã® `meta` è¦å‰‡ã‚’ä½¿ç”¨ã™ã‚‹

v1 ã®è¦å‰‡ã‚’å¼•ãç¶šãä½¿ç”¨ã™ã‚‹ã«ã¯ã€`@remix-run/v1-meta` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã€`meta` ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’æ›´æ–°ã§ãã¾ã™ã€‚

`metaV1` é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€`meta` é–¢æ•°ã®å¼•æ•°ã¨ã€ç¾åœ¨è¿”ã•ã‚Œã¦ã„ã‚‹ã®ã¨åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€åŒã˜ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€ãƒªãƒ¼ãƒ•ãƒ¬ãƒ™ãƒ«ã®ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’ãã®**ç›´æ¥ã®è¦ªãƒ«ãƒ¼ãƒˆ**ã®ãƒ¡ã‚¿ã¨ãƒãƒ¼ã‚¸ã—ã€v2 ã§ä½¿ç”¨ã§ãã‚‹ãƒ¡ã‚¿è¨˜è¿°å­ã®é…åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export function meta() {
  return {
    title: "...",
    description: "...",
    "og:title": "...",
  };
}
```

```tsx filename=app/routes/v2-route.tsx good
import { metaV1 } from "@remix-run/v1-meta";

export function meta(args) {
  return metaV1(args, {
    title: "...",
    description: "...",
    "og:title": "...",
  });
}
```

ã“ã®é–¢æ•°ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€éšå±¤å…¨ä½“ã§ãƒ¡ã‚¿ã‚’ãƒãƒ¼ã‚¸ã—ãªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒ«ãƒ¼ãƒˆã«ã‚ˆã£ã¦ã¯ã€`metaV1` é–¢æ•°ãªã—ã«ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’ç›´æ¥è¿”ã™å ´åˆãŒã‚ã‚Šã€äºˆæœŸã›ã¬å‹•ä½œã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚éšå±¤å…¨ä½“ã§ãƒ¡ã‚¿ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹å ´åˆã¯ã€ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã® `meta` ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã« `metaV1` é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

#### `parentsData` å¼•æ•°

v2 ã§ã¯ã€`meta` é–¢æ•°ã¯ `parentsData` å¼•æ•°ã‚’å—ã‘å–ã‚‰ãªããªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ã€`meta` ãŒã€å„ãƒãƒƒãƒã®ãƒ­ãƒ¼ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ [`matches` å¼•æ•°][meta-v2-matches] ã‚’ä»‹ã—ã¦ã€ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆãƒãƒƒãƒã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã§ã™ã€‚

`parentsData` ã® API ã‚’è¤‡è£½ã™ã‚‹ã«ã¯ã€`@remix-run/v1-meta` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒ `getMatchesData` é–¢æ•°ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€å„ãƒãƒƒãƒã®ãƒ‡ãƒ¼ã‚¿ãŒã€ãƒ«ãƒ¼ãƒˆã® ID ã‚’ã‚­ãƒ¼ã¨ã—ã¦è¿”ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export function meta(args) {
  const parentData = args.parentsData["routes/parent"];
}
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
import { getMatchesData } from "@remix-run/v1-meta";

export function meta(args) {
  const matchesData = getMatchesData(args);
  const parentData = matchesData["routes/parent"];
}
```

#### æ–°ã—ã„ `meta` ã«æ›´æ–°ã™ã‚‹

```tsx bad filename=app/routes/v1-route.tsx
export function meta() {
  return {
    title: "...",
    description: "...",
    "og:title": "...",
  };
}
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
export function meta() {
  return [
    { title: "..." },
    { name: "description", content: "..." },
    { property: "og:title", content: "..." },

    // SEO é–¢é€£ã® <links> ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
    { tagName: "link", rel: "canonical", href: "..." },

    // ãã—ã¦ <script type=ld+json>
    {
      "script:ld+json": {
        some: "value",
      },
    },
  ];
}
```

#### `matches` å¼•æ•°

v1 ã§ã¯ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã‹ã‚‰è¿”ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã™ã¹ã¦ãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯ `matches` ã‚’ä½¿ç”¨ã—ã¦ã€ãƒãƒ¼ã‚¸ã‚’è‡ªåˆ†ã§ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
export function meta({ matches }) {
  const rootMeta = matches[0].meta;
  const title = rootMeta.find((m) => m.title);

  return [
    title,
    { name: "description", content: "..." },
    { property: "og:title", content: "..." },

    // SEO é–¢é€£ã® <links> ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
    { tagName: "link", rel: "canonical", href: "..." },

    // ãã—ã¦ <script type=ld+json>
    {
      "script:ld+json": {
        "@context": "https://schema.org",
        "@type": "Organization",
        name: "Remix",
      },
    },
  ];
}
```

[meta][meta] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã®ãƒãƒ¼ã‚¸ã«é–¢ã™ã‚‹è©³ç´°ãªãƒ’ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

## `CatchBoundary` ã¨ `ErrorBoundary`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_errorBoundary: true,
  },
};
```

v1 ã§ã¯ã€ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸ `Response` ã¯ã€æœ€ã‚‚è¿‘ã„ `CatchBoundary` ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ãã®ä»–ã®å‡¦ç†ã•ã‚Œãªã„ä¾‹å¤–ã¯ã€`ErrorBoundary` ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã—ãŸã€‚v2 ã«ã¯ `CatchBoundary` ã¯å­˜åœ¨ã›ãšã€å‡¦ç†ã•ã‚Œãªã„ã™ã¹ã¦ã®ä¾‹å¤–ã¯ã€`ErrorBoundary`ã€å¿œç­”ãªã©ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚

ã•ã‚‰ã«ã€ã‚¨ãƒ©ãƒ¼ã¯ã€`ErrorBoundary` ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦æ¸¡ã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚ä»£ã‚ã‚Šã«ã€`useRouteError` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useCatch } from "@remix-run/react";

export function CatchBoundary() {
  const caught = useCatch();

  return (
    <div>
      <h1>Oops</h1>
      <p>Status: {caught.status}</p>
      <p>{caught.data.message}</p>
    </div>
  );
}

export function ErrorBoundary({ error }) {
  console.error(error);
  return (
    <div>
      <h1>Uh oh ...</h1>
      <p>Something went wrong</p>
      <pre>{error.message || "Unknown error"}</pre>
    </div>
  );
}
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
import {
  useRouteError,
  isRouteErrorResponse,
} from "@remix-run/react";

export function ErrorBoundary() {
  const error = useRouteError();

  // true ã®å ´åˆã€ã“ã‚Œã¯ä»¥å‰ `CatchBoundary` ã«æ¸¡ã•ã‚Œã¦ã„ãŸã‚‚ã®ã§ã™ã€‚
  if (isRouteErrorResponse(error)) {
    return (
      <div>
        <h1>Oops</h1>
        <p>Status: {error.status}</p>
        <p>{error.data.message}</p>
      </div>
    );
  }

  // ç‹¬è‡ªã®ãƒ­ã‚¸ãƒƒã‚¯ã§å‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚
  // ã‚¨ãƒ©ãƒ¼ã ã‘ã§ãªãã€ã™ã¹ã¦ã®å€¤ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼
  let errorMessage = "Unknown error";
  if (isDefinitelyAnError(error)) {
    errorMessage = error.message;
  }

  return (
    <div>
      <h1>Uh oh ...</h1>
      <p>Something went wrong.</p>
      <pre>{errorMessage}</pre>
    </div>
  );
}
```

## `formMethod`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_normalizeFormMethod: true,
  },
};
```

è¤‡æ•°ã® API ãŒã€é€ä¿¡ã® `formMethod` ã‚’è¿”ã—ã¾ã™ã€‚v1 ã§ã¯ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å°æ–‡å­—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¿”ã•ã‚Œã¾ã—ãŸãŒã€v2 ã§ã¯ã€å¤§æ–‡å­—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¿”ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€HTTP ã¨ `fetch` ã®ä»•æ§˜ã«åˆã‚ã›ã¦ã€çµ±ä¸€ã—ãŸã‚‚ã®ã§ã™ã€‚

```tsx
function Something() {
  const navigation = useNavigation();

  // v1
  navigation.formMethod === "post";

  // v2
  navigation.formMethod === "POST";
}

export function shouldRevalidate({ formMethod }) {
  // v1
  formMethod === "post";

  // v2
  formMethod === "POST";
}
```

## `useTransition`

ã“ã®ãƒ•ãƒƒã‚¯ã¯ã€æœ€è¿‘åŒã˜åå‰ã® React ãƒ•ãƒƒã‚¯ã¨æ··åŒã•ã‚Œãªã„ã‚ˆã†ã«ã€`useNavigation` ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã¾ãŸã€`type` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å­˜åœ¨ã›ãšã€`submission` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ `navigation` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªä½“ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useTransition } from "@remix-run/react";

function SomeComponent() {
  const transition = useTransition();
  transition.submission.formData;
  transition.submission.formMethod;
  transition.submission.formAction;
  transition.type;
}
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
import { useNavigation } from "@remix-run/react";

function SomeComponent() {
  const navigation = useNavigation();

  // transition.submission ã®ã‚­ãƒ¼ã¯ã€`navigation[key]` ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã™ã€‚
  navigation.formData;
  navigation.formMethod;
  navigation.formAction;

  // ã“ã®ã‚­ãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
  navigation.type;
}
```

å‰ã® `transition.type` ã¯ã€æ¬¡ã®ä¾‹ã‹ã‚‰å°ãå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€`navigation.state`ã€`navigation.formData`ã€ã¾ãŸã¯ `useActionData` ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ãªã©ã€é€šå¸¸ã¯ã‚‚ã£ã¨ç°¡å˜ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚Discord ã§ãŠæ°—è»½ã«ã”è³ªå•ãã ã•ã„ã€‚:D

```tsx
function Component() {
  const navigation = useNavigation();

  // transition.type === "actionSubmission"
  const isActionSubmission =
    navigation.state === "submitting";

  // transition.type === "actionReload"
  const isActionReload =
    navigation.state === "loading" &&
    navigation.formMethod != null &&
    navigation.formMethod != "GET" &&
    // é€ä¿¡ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€é€ä¿¡ã•ã‚ŒãŸå ´æ‰€ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹
    navigation.formAction === navigation.location.pathname;

  // transition.type === "actionRedirect"
  const isActionRedirect =
    navigation.state === "loading" &&
    navigation.formMethod != null &&
    navigation.formMethod != "GET" &&
    // é€ä¿¡ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€åˆ¥ã®å ´æ‰€ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã¦ã„ã‚‹
    navigation.formAction !== navigation.location.pathname;

  // transition.type === "loaderSubmission"
  const isLoaderSubmission =
    navigation.state === "loading" &&
    navigation.state.formMethod === "GET" &&
    // ãƒ­ãƒ¼ãƒ€ãƒ¼ã®é€ä¿¡ãŒã‚ã‚Šã€é€ä¿¡ã•ã‚ŒãŸå ´æ‰€ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã¦ã„ã‚‹
    navigation.formAction === navigation.location.pathname;

  // transition.type === "loaderSubmissionRedirect"
  const isLoaderSubmissionRedirect =
    navigation.state === "loading" &&
    navigation.state.formMethod === "GET" &&
    // ãƒ­ãƒ¼ãƒ€ãƒ¼ã®é€ä¿¡ãŒã‚ã‚Šã€æ–°ã—ã„å ´æ‰€ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã¦ã„ã‚‹
    navigation.formAction !== navigation.location.pathname;
}
```

**GET é€ä¿¡ã«é–¢ã™ã‚‹æ³¨è¨˜**

Remix v1 ã§ã¯ã€`<Form method="get">` ã‚„ `submit({}, { method: 'get' })` ãªã©ã® GET é€ä¿¡ã¯ã€`transition.state` ã§ `idle -> submitting -> idle` ã®é·ç§»ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ "é€ä¿¡" ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€GET ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãŠã‚Šã€ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ï¼‰ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã«æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚æ©Ÿèƒ½çš„ã«ã¯ã€`<Link>` ã‚„ `navigate()` ã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¥åŠ›ã‚’ä½¿ç”¨ã—ã¦æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

v2 ã§ã¯ã€GET é€ä¿¡ã¯ã€ã‚ˆã‚Šæ­£ç¢ºã«ãƒ­ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦åæ˜ ã•ã‚Œã€`navigation.state` ã¯é€šå¸¸ã®ãƒªãƒ³ã‚¯ã®å‹•ä½œã«åˆã‚ã›ã¦ã€`idle -> loading -> idle` ã¨ãªã‚Šã¾ã™ã€‚GET é€ä¿¡ãŒ `<Form>` ã‚„ `submit()` ã‹ã‚‰æ¥ãŸå ´åˆã¯ã€`useNavigation.form*` ãŒè¨­å®šã•ã‚Œã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦åŒºåˆ¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## `useFetcher`

`useNavigation` ã¨åŒæ§˜ã«ã€`useFetcher` ã¯ `submission` ã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã—ã€`type` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useFetcher } from "@remix-run/react";

function SomeComponent() {
  const fetcher = useFetcher();
  fetcher.submission.formData;
  fetcher.submission.formMethod;
  fetcher.submission.formAction;
  fetcher.type;
}
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
import { useFetcher } from "@remix-run/react";

function SomeComponent() {
  const fetcher = useFetcher();

  // ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ã¯ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã™ã€‚
  fetcher.formData;
  fetcher.formMethod;
  fetcher.formAction;

  // ã“ã®ã‚­ãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
  fetcher.type;
}
```

å‰ã® `fetcher.type` ã¯ã€æ¬¡ã®ä¾‹ã‹ã‚‰å°ãå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€`fetcher.state`ã€`fetcher.formData`ã€ã¾ãŸã¯ `fetcher.data` ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ãªã©ã€é€šå¸¸ã¯ã‚‚ã£ã¨ç°¡å˜ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚Discord ã§ãŠæ°—è»½ã«ã”è³ªå•ãã ã•ã„ã€‚:D

```tsx
function Component() {
  const fetcher = useFetcher();

  // fetcher.type === "init"
  const isInit =
    fetcher.state === "idle" && fetcher.data == null;

  // fetcher.type === "done"
  const isDone =
    fetcher.state === "idle" && fetcher.data != null;

  // fetcher.type === "actionSubmission"
  const isActionSubmission = fetcher.state === "submitting";

  // fetcher.type === "actionReload"
  const isActionReload =
    fetcher.state === "loading" &&
    fetcher.formMethod != null &&
    fetcher.formMethod != "GET" &&
    // ãƒ‡ãƒ¼ã‚¿ãŒè¿”ã•ã‚ŒãŸå ´åˆã¯ã€ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    fetcher.data != null;

  // fetcher.type === "actionRedirect"
  const isActionRedirect =
    fetcher.state === "loading" &&
    fetcher.formMethod != null &&
    fetcher.formMethod != "GET" &&
    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    fetcher.data == null;

  // fetcher.type === "loaderSubmission"
  const isLoaderSubmission =
    fetcher.state === "loading" &&
    fetcher.formMethod === "GET";

  // fetcher.type === "normalLoad"
  const isNormalLoad =
    fetcher.state === "loading" &&
    fetcher.formMethod == null;
}
```

**GET é€ä¿¡ã«é–¢ã™ã‚‹æ³¨è¨˜**

Remix v1 ã§ã¯ã€`<fetcher.Form method="get">` ã‚„ `fetcher.submit({}, { method: 'get' })` ãªã©ã® GET é€ä¿¡ã¯ã€`fetcher.state` ã§ `idle -> submitting -> idle` ã®é·ç§»ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ "é€ä¿¡" ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãŠã‚Šã€ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ï¼‰ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã«æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚æ©Ÿèƒ½çš„ã«ã¯ã€`fetcher.load()` ã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¥åŠ›ã‚’ä½¿ç”¨ã—ã¦æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

v2 ã§ã¯ã€GET é€ä¿¡ã¯ã€ã‚ˆã‚Šæ­£ç¢ºã«ãƒ­ãƒ¼ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦åæ˜ ã•ã‚Œã€`fetcher.state` ã¯é€šå¸¸ã® fetcher ãƒ­ãƒ¼ãƒ‰ã®å‹•ä½œã«åˆã‚ã›ã¦ã€`idle -> loading -> idle` ã¨ãªã‚Šã¾ã™ã€‚GET é€ä¿¡ãŒ `<fetcher.Form>` ã‚„ `fetcher.submit()` ã‹ã‚‰æ¥ãŸå ´åˆã¯ã€`fetcher.form*` ãŒè¨­å®šã•ã‚Œã‚‹ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦åŒºåˆ¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãƒªãƒ³ã‚¯ã® `imagesizes` ã¨ `imagesrcset`

ãƒ«ãƒ¼ãƒˆã® `links` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã™ã¹ã¦ã€HTML ã®å°æ–‡å­—ã§ã¯ãªãã€React ã®ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã®å€¤ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã® 2 ã¤ã®å€¤ã¯ã€v1 ã§ã¯å°æ–‡å­—ã§è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚v2 ã§ã¯ã€ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã®ã¿ãŒæœ‰åŠ¹ã§ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export const links: LinksFunction = () => {
  return [
    {
      rel: "preload",
      as: "image",
      imagesrcset: "...",
      imagesizes: "...",
    },
  ];
};
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx filename=app/routes/v2-route.tsx good
export const links: V2_LinksFunction = () => {
  return [
    {
      rel: "preload",
      as: "image",
      imageSrcSet: "...",
      imageSizes: "...",
    },
  ];
};
```

## `browserBuildDirectory`

`remix.config.js` ã® `browserBuildDirectory` ã‚’ `assetsBuildDirectory` ã«åå‰ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```js bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserBuildDirectory: "./public/build",
};
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js filename=remix.config.js good lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  assetsBuildDirectory: "./public/build",
};
```

## `devServerBroadcastDelay`

`remix.config.js` ã‹ã‚‰ `devServerBroadcastDelay` ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¿…è¦ã¨ã—ãŸç«¶åˆçŠ¶æ…‹ãŒã€v2 ã¾ãŸã¯ `v2_dev` ã§è§£æ¶ˆã•ã‚ŒãŸãŸã‚ã§ã™ã€‚

```diff filename=remix.config.js
  /** @type {import('@remix-run/dev').AppConfig} */
  module.exports = {
-   devServerBroadcastDelay: 300,
  };
```

## `devServerPort`

`remix.config.js` ã® `devServerPort` ã‚’ `future.v2_dev.port` ã«åå‰ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```js bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  devServerPort: 8002,
};
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js filename=remix.config.js good lines=[3-7]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  // v1.x ã§ã¯ã€ã“ã‚Œã¯ Future Flag ã‚’ä»‹ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚
  future: {
    v2_dev: {
      port: 8002,
    },
  },
};
```

v1 ã‹ã‚‰ v2 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ã“ã‚Œã¯ [ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã® `dev` æ§‹æˆ][dev-after-upgrading] ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã•ã‚Œã¾ã™ã€‚

## `serverBuildDirectory`

`remix.config.js` ã® `serverBuildDirectory` ã‚’ `serverBuildPath` ã«åå‰ã‚’å¤‰æ›´ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ãªãã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```js bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverBuildDirectory: "./build",
};
```

æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js filename=remix.config.js good lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverBuildPath: "./build/index.js",
};
```

Remix ã¯ä»¥å‰ã¯ã€ã‚µãƒ¼ãƒãƒ¼ç”¨ã«è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯ 1 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## `serverBuildTarget`

ãƒ“ãƒ«ãƒ‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹ä»£ã‚ã‚Šã«ã€[`remix.config.js`][remix_config] ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒæœŸå¾…ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ“ãƒ«ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€Remix ã¯ã€Remix ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã“ã‚Œã‚‰ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ã‚µãƒ¼ãƒãƒ¼ã€ãƒ›ã‚¹ãƒˆã«ã¤ã„ã¦çŸ¥ã‚‹å¿…è¦ãªã—ã«ã€ã‚ˆã‚Šå¤šãã® JavaScript ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ã‚µãƒ¼ãƒãƒ¼ã€ãƒ›ã‚¹ãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

æ¬¡ã®æ§‹æˆã¯ã€ç¾åœ¨ã® `serverBuildTarget` ã‚’ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### `arc`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/_static/build/",
  serverBuildPath: "server/index.js",
  serverMainFields: ["main", "module"], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverModuleFormat: "cjs", // 1.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«è¿½åŠ ã—ã¾ã™ã€‚
  serverPlatform: "node", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
};
```

#### `cloudflare-pages`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverBuildPath: "functions/[[path]].js",
  serverConditions: ["worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["browser", "module", "main"],
  serverMinify: true,
  serverModuleFormat: "esm", // 2.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã¯å‰Šé™¤ã§ãã¾ã™ã€‚
  serverPlatform: "neutral",
};
```

#### `cloudflare-workers`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverConditions: ["worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["browser", "module", "main"],
  serverMinify: true,
  serverModuleFormat: "esm", // 2.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã¯å‰Šé™¤ã§ãã¾ã™ã€‚
  serverPlatform: "neutral",
};
```

#### `deno`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverConditions: ["deno", "worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["module", "main"],
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverModuleFormat: "esm", // 2.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã¯å‰Šé™¤ã§ãã¾ã™ã€‚
  serverPlatform: "neutral",
};
```

#### `node-cjs`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverMainFields: ["main", "module"], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
  serverModuleFormat: "cjs", // 1.x ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«è¿½åŠ ã—ã¾ã™ã€‚
  serverPlatform: "node", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚Šã€å‰Šé™¤ã§ãã¾ã™ã€‚
};
```

## `serverModuleFormat`

ã‚µãƒ¼ãƒãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‡ºåŠ›å½¢å¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€`cjs` ã‹ã‚‰ `esm` ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚v2 ã§ã‚‚ CJS ã‚’ä½¿ã„ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¢ãƒ—ãƒªã®å¤šãã®ä¾å­˜é–¢ä¿‚ã¯ã€ESM ã¨äº’æ›æ€§ãŒãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

`remix.config.js` ã§ã¯ã€`serverModuleFormat: "cjs"` ã‚’æŒ‡å®šã—ã¦æ—¢å­˜ã®å‹•ä½œã‚’ç¶­æŒã™ã‚‹ã‹ã€`serverModuleFormat: "esm"` ã‚’æŒ‡å®šã—ã¦æ–°ã—ã„å‹•ä½œã‚’ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## `browserNodeBuiltinsPolyfill`

ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã€Node.js ã®çµ„ã¿è¾¼ã¿