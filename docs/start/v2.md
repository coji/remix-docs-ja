---
title: v2ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
order: 3
---

# v2ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

<docs-warning>ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯[ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªRemixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©][classic-remix-compiler]ã‚’ä½¿ã£ã¦v1ã‹ã‚‰v2ã«ç§»è¡Œã™ã‚‹éš›ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚Viteã¸ã®ç§»è¡Œã«é–¢ã™ã‚‹ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã«ã¤ã„ã¦ã¯ã€[Remix Viteã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ][remix-vite]ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</docs-warning>

ã™ã¹ã¦ã®v2 APIã¨behaviorã¯v1ã®[Future Flags][future-flags]ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºã‚’ä¸­æ–­ã•ã›ãªã„ã‚ˆã†ã€1ã¤ãšã¤ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ãã“ã¨ãŒã§ãã¾ã™ã€‚ã™ã¹ã¦ã®ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹ã«ã—ãŸå¾Œã¯ã€v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã€éç ´å£Šçš„ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¯èƒ½ã§ã™ã€‚

ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå¿…è¦ãªå ´åˆã¯ã€[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³][troubleshooting]ã‚’ã”è¦§ãã ã•ã„ã€‚

ä¸€èˆ¬çš„ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å•é¡Œã«ã¤ã„ã¦ã€[ğŸ¥ 2åˆ†ã§v2ã«][2-min-to-v2]ã®ãƒ“ãƒ‡ã‚ªã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## `remix dev`

è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€[`remix dev`ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ][dev-docs]ã‚’ã”è¦§ãã ã•ã„ã€‚

### `remix-serve`

Remix App Server (`remix-serve`)ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€`v2_dev`ã‚’æœ‰åŠ¹ã«ã—ã¾ã™:

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_dev: true,
  },
};
```

ä»¥ä¸Šã§ã™!

### ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼

ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ (`server.js`) ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€
[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][templates]ã‚’ç¢ºèªã—ã¦`v2_dev`ã¨ã®çµ±åˆæ–¹æ³•ã‚’å‚è€ƒã«ã™ã‚‹ã‹ã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„:

1. `v2_dev`ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™:

   ```js filename=remix.config.js
   /** @type {import('@remix-run/dev').AppConfig} */
   module.exports = {
     future: {
       v2_dev: true,
     },
   };
   ```

2. `package.json`ã®`scripts`ã‚’æ›´æ–°ã—ã¾ã™:

   - `remix watch`ã‚’`remix dev`ã«ç½®ãæ›ãˆã¾ã™
   - å†—é•·ãª`NODE_ENV=development`ã‚’å‰Šé™¤ã—ã¾ã™
   - `-c` / `--command`ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã—ã¾ã™

   ä¾‹:

   ```diff filename=package.json
    {
      "scripts": {
   -    "dev:remix": "cross-env NODE_ENV=development remix watch",
   -    "dev:server": "cross-env NODE_ENV=development node ./server.js"
   +    "dev": "remix dev -c 'node ./server.js'",
      }
    }
   ```

3. ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã‚‰ã€Remixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã« "ready" ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™

   ```ts filename=server.js lines=[1-2,11]
   import { broadcastDevReady } from "@remix-run/node";
   // import { logDevReady } from "@remix-run/cloudflare" // CloudFlareã‚’ä½¿ã†å ´åˆã¯ `logDevReady` ã‚’ä½¿ã†

   const BUILD_DIR = path.join(process.cwd(), "build");

   // ... ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚³ãƒ¼ãƒ‰ã“ã“ã« ...

   const port = 3000;
   app.listen(port, async () => {
     console.log(`ğŸ‘‰ http://localhost:${port}`);
     broadcastDevReady(await import(BUILD_DIR));
   });
   ```

4. (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) `--manual`

   `require`ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ‘ãƒ¼ã‚¸ãƒ³ã‚°ã«ä¾å­˜ã—ã¦ã„ãŸå ´åˆã¯ã€`--manual`ãƒ•ãƒ©ã‚°ã‚’ä½¿ã†ã“ã¨ã§ç¶™ç¶šã§ãã¾ã™:

   ```shellscript nonumber
   remix dev --manual -c 'node ./server.js'
   ```

   è©³ç´°ã¯[ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ã‚¬ã‚¤ãƒ‰][manual-mode]ã‚’ã”è¦§ãã ã•ã„ã€‚

### v1ã‹ã‚‰v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸå¾Œ

v1ã§`future.v2_dev`ãƒ•ãƒ©ã‚°ã‚’æœ‰åŠ¹åŒ–ã—ã€ãã‚ŒãŒå‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã€v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚
`v2_dev`ã‚’`true`ã«è¨­å®šã—ã¦ã„ãŸå ´åˆã¯ã€ãã‚Œã‚’å‰Šé™¤ã™ã‚Œã°å‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚

`v2_dev`è¨­å®šã‚’ä½¿ã£ã¦ã„ãŸå ´åˆã¯ã€`dev`è¨­å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

```diff filename=remix.config.js
  /** @type {import('@remix-run/dev').AppConfig} */
  module.exports = {
-   future: {
-     v2_dev: {
-       port: 4004
-     }
-   }
+   dev: {
+     port: 4004
+   }
  }
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒ³

#### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã›ãšã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹

ä»Šã®ã¨ã“ã‚å¤‰æ›´ã—ãŸããªã„ (ã‚ã‚‹ã„ã¯æ°¸é ã«å¤‰æ›´ã—ãŸããªã„) å ´åˆã¯ã€`@remix-run/v1-route-convention`ã‚’ä½¿ã£ã¦v1ã®ã‚³ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒ³ã‚’ç¶™ç¶šã§ãã¾ã™ã€‚

```shellscript nonumber
npm i -D @remix-run/v1-route-convention
```

```js filename=remix.config.js
const {
  createRoutesFromFolders,
} = require("@remix-run/v1-route-convention");

/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    // v1.15+ã§warningã‚’æ¶ˆã—ã¾ã™
    v2_routeConvention: true,
  },

  routes(defineRoutes) {
    // v1ã®ã‚³ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒ³ã‚’ä½¿ã„ã¾ã™ã€‚v1.15+ã¨v2ã§æ©Ÿèƒ½ã—ã¾ã™
    return createRoutesFromFolders(defineRoutes);
  },
};
```

#### æ–°ã—ã„ã‚³ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

- ãƒ«ãƒ¼ãƒˆã®ãƒã‚¹ãƒˆã¯ã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒã‚¹ãƒˆã§ã¯ãªãã€ãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒ‰ãƒƒãƒˆ(`.`)ã§ä½œæˆã•ã‚Œã¾ã™
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®`suffixed_`ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã¯ãƒã‚¹ãƒˆã‚’ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆã—ã€è¦ªãƒ«ãƒ¼ãƒˆã¨ã®ãƒãƒƒãƒãƒ³ã‚°ã‚’é¿ã‘ã¾ã™(ãƒ‰ãƒƒãƒˆ(`.`)ã®ä»£ã‚ã‚Šã«)
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®`_prefixed`ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã¯ã€`__double`ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ä»£ã‚ã‚Šã«ãƒ‘ã‚¹ã®ãªã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™
- `_index.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã€`index.tsx`ã§ã¯ã‚ã‚Šã¾ã›ã‚“

v1ã§ã¯æ¬¡ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒ:

```text bad
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __auth/
â”‚   â”‚   â”œâ”€â”€ login.tsx
â”‚   â”‚   â”œâ”€â”€ logout.tsx
â”‚   â”‚   â””â”€â”€ signup.tsx
â”‚   â”œâ”€â”€ __public/
â”‚   â”‚   â”œâ”€â”€ about-us.tsx
â”‚   â”‚   â”œâ”€â”€ contact.tsx
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ calendar/
â”‚   â”‚   â”‚   â”œâ”€â”€ $day.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â”œâ”€â”€ $projectId/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ collaborators.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ edit.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tasks.$taskId.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ $projectId.tsx
â”‚   â”‚   â”‚   â””â”€â”€ new.tsx
â”‚   â”‚   â”œâ”€â”€ calendar.tsx
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â””â”€â”€ projects.tsx
â”‚   â”œâ”€â”€ __auth.tsx
â”‚   â”œâ”€â”€ __public.tsx
â”‚   â””â”€â”€ dashboard.projects.$projectId.print.tsx
â””â”€â”€ root.tsx
```

`v2_routeConvention`ã‚’ä½¿ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:

```text good
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _auth.login.tsx
â”‚   â”œâ”€â”€ _auth.logout.tsx
â”‚   â”œâ”€â”€ _auth.signup.tsx
â”‚   â”œâ”€â”€ _auth.tsx
â”‚   â”œâ”€â”€ _public._index.tsx
â”‚   â”œâ”€â”€ _public.about-us.tsx
â”‚   â”œâ”€â”€ _public.contact.tsx
â”‚   â”œâ”€â”€ _public.tsx
â”‚   â”œâ”€â”€ dashboard._index.tsx
â”‚   â”œâ”€â”€ dashboard.calendar._index.tsx
â”‚   â”œâ”€â”€ dashboard.calendar.$day.tsx
â”‚   â”œâ”€â”€ dashboard.calendar.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId._index.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.collaborators.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.edit.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.settings.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.tasks.$taskId.tsx
â”‚   â”œâ”€â”€ dashboard.projects.$projectId.tsx
â”‚   â”œâ”€â”€ dashboard.projects.new.tsx
â”‚   â”œâ”€â”€ dashboard.projects.tsx
â”‚   â””â”€â”€ dashboard_.projects.$projectId.print.tsx
â””â”€â”€ root.tsx
```

è¦ªãƒ«ãƒ¼ãƒˆãŒãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒã‚¹ãƒˆã®ä»£ã‚ã‚Šã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™(èªè¨¼ãƒ«ãƒ¼ãƒˆãªã©)ã€‚åŒã˜ãƒ‘ã‚¹ã‚’æŒã¤ãŒåŒã˜ãƒã‚¹ãƒˆã§ã¯ãªã„ãƒ«ãƒ¼ãƒˆ(ä¾‹ãˆã° `dashboard`ã¨`dashboard_`)ã‚‚ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã¾ã™ã€‚

æ–°ã—ã„ã‚³ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ `route.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ãƒ«ãƒ¼ãƒˆã‚’è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ«ãƒ¼ãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã¾ã™:

ä¾‹ãˆã°ã€`_public.tsx`ã‚’`_public/route.tsx`ã«ç§»å‹•ã—ã€ãƒ«ãƒ¼ãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã¾ã™:

```text
app/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ _auth.tsx
â”‚   â”œâ”€â”€ _public/
â”‚   â”‚   â”œâ”€â”€ footer.tsx
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â””â”€â”€ route.tsx
â”‚   â”œâ”€â”€ _public._index.tsx
â”‚   â”œâ”€â”€ _public.about-us.tsx
â”‚   â””â”€â”€ etc.
â””â”€â”€ root.tsx
```

ã“ã®å¤‰æ›´ã®èƒŒæ™¯ã«ã¤ã„ã¦ã¯ã€[å…ƒã® "ãƒ•ãƒ©ãƒƒãƒˆãƒ«ãƒ¼ãƒˆ" ã®ææ¡ˆ][flat-routes]ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ«ãƒ¼ãƒˆã®`headers`

Remix v2ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã® `headers`é–¢æ•°ã®å‹•ä½œãŒã‚ãšã‹ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚`remix.config.js`ã®`future.v2_headers`ãƒ•ãƒ©ã‚°ã‚’ä½¿ã£ã¦ã€ã“ã®æ–°ã—ã„å‹•ä½œã‚’ã‚ã‚‰ã‹ã˜ã‚é¸æŠã§ãã¾ã™ã€‚

v1ã§ã¯ã€Remixã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹æœ€çµ‚ãƒ«ãƒ¼ãƒˆã®`headers`é–¢æ•°ã®çµæœã®ã¿ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚è¦ªãƒ«ãƒ¼ãƒˆã®`parentHeaders`ã‚’é©åˆ‡ã«ãƒãƒ¼ã‚¸ã™ã‚‹ã‚ˆã†ã«ã€ã™ã¹ã¦ã®æ½œåœ¨çš„ãªãƒªãƒ¼ãƒ•ã«ã«`headers`é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ã™ãã«ã‚ã‚“ã©ã†ãã•ããªã‚Šã€æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ã—ãŸéš›ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å…±æœ‰ã—ãŸã„ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€`headers`é–¢æ•°ã‚’å¿˜ã‚ŒãŒã¡ã§ã—ãŸã€‚

v2ã§ã¯ã€Remixã¯æç”»ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã®ä¸­ã§æœ€ã‚‚æ·±ã„`headers`é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å…±é€šã®ç¥–å…ˆã‹ã‚‰`headers`é–¢æ•°ã‚’å…±æœ‰ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ãã—ã¦å¿…è¦ã«å¿œã˜ã¦ã€ã‚ˆã‚Šæ·±ã„ãƒ«ãƒ¼ãƒˆã«`headers`é–¢æ•°ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

## ãƒ«ãƒ¼ãƒˆã®`meta`

Remix v2ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã®`meta`é–¢æ•°ã®ç½²åã¨RemixãŒãƒ¡ã‚¿ã‚¿ã‚°ã‚’å†…éƒ¨çš„ã«å‡¦ç†ã™ã‚‹æ–¹æ³•ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

`meta`ã‹ã‚‰è¿”ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä»£ã‚ã‚Šã«ã€è¨˜è¿°å­ã®é…åˆ—ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`meta`APIãŒ`links`ã«è¿‘ã¥ãã€ãƒ¡ã‚¿ã‚¿ã‚°ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ã‚ˆã‚ŠæŸ”è»Ÿã«åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€`<Meta />`ã¯ã‚‚ã¯ã‚„ãƒ«ãƒ¼ãƒˆéšå±¤å…¨ä½“ã®ãƒ¡ã‚¿ã‚¿ã‚°ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãªããªã‚Šã¾ã—ãŸã€‚ãƒªãƒ¼ãƒ•ãƒ«ãƒ¼ãƒˆã®`meta`ã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚[`matches`ã‚’é–¢æ•°ã®å¼•æ•°][meta-v2-matches]ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã€è¦ªãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’å«ã‚ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ã“ã®å¤‰æ›´ã®èƒŒæ™¯ã«ã¤ã„ã¦ã¯ã€[v2ã®`meta`ã«é–¢ã™ã‚‹ææ¡ˆ][meta-v2-rfc]ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### v1ã®`meta`è¦ç´„ã‚’v2ã§ä½¿ã†

`@remix-run/v1-meta`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã€v1ã®è¦ç´„ã‚’ç¶™ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`metaV1`é–¢æ•°ã‚’ä½¿ã†ã¨ã€`meta`é–¢æ•°ã®å¼•æ•°ã¨ç¾åœ¨è¿”ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€v2ã§ä½¿ç”¨å¯èƒ½ãª meta è¨˜è¿°å­ã®é…åˆ—ã«å¤‰æ›ã™ã‚‹å‰ã«ã€ãƒªãƒ¼ãƒ•ãƒ«ãƒ¼ãƒˆã®ãƒ¡ã‚¿ã‚’**ç›´æ¥ã®è¦ªãƒ«ãƒ¼ãƒˆ**ã®ãƒ¡ã‚¿ã¨ãƒãƒ¼ã‚¸ã—ã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export function meta() {
  return {
    title: "...",
    description: "...",
    "og:title": "...",
  };
}
```

```tsx filename=app/routes/v2-route.tsx good
import { metaV1 } from "@remix-run/v1-meta";

export function meta(args) {
  return metaV1(args, {
    title: "...",
    description: "...",
    "og:title": "...",
  });
}
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã“ã®é–¢æ•°ã¯**ç›´æ¥ã®è¦ªãƒ«ãƒ¼ãƒˆ**ã®ãƒ¡ã‚¿ã¨ã®ã¿ãƒãƒ¼ã‚¸ã‚’è¡Œã†ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€ä¸€éƒ¨ã®ãƒ«ãƒ¼ãƒˆãŒç›´æ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’è¿”ã™å ´åˆã€äºˆæœŸã›ã¬å‹•ä½œãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚éšå±¤å…¨ä½“ã®ãƒ¡ã‚¿ã‚’ãƒãƒ¼ã‚¸ã—ãŸã„å ´åˆã¯ã€ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã®`meta`ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§`metaV1`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

#### `parentsData`å¼•æ•°

v2ã§ã¯ã€`meta`é–¢æ•°ã«ã¯`parentsData`å¼•æ•°ãŒæ¸¡ã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ã€`meta`ãŒ[`matches`å¼•æ•°][meta-v2-matches]ã‚’ä»‹ã—ã¦ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆãƒãƒƒãƒã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã§ã™ã€‚

`parentsData`APIã‚’å†ç¾ã™ã‚‹ã«ã¯ã€`@remix-run/v1-meta`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®`getMatchesData`é–¢æ•°ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å„ãƒãƒƒãƒã®ãƒ‡ãƒ¼ã‚¿ãŒãƒ«ãƒ¼ãƒˆã®IDã‚’ã‚­ãƒ¼ã¨ã—ã¦è¿”ã•ã‚Œã¾ã™ã€‚

```tsx bad filename=app/routes/v1-route.tsx
export function meta(args) {
  const parentData = args.parentsData["routes/parent"];
}
```

å¤‰æ›´å¾Œ:


```tsx filename=app/routes/v2-route.tsx good
import { getMatchesData } from "@remix-run/v1-meta";

export function meta(args) {
  const matchesData = getMatchesData(args);
  const parentData = matchesData["routes/parent"];
}
```

#### æ–°ã—ã„`meta`ã¸ã®ç§»è¡Œ

```tsx bad filename=app/routes/v1-route.tsx
export function meta() {
  return {
    title: "...",
    description: "...",
    "og:title": "...",
  };
}
```

```tsx filename=app/routes/v2-route.tsx good
export function meta() {
  return [
    { title: "..." },
    { name: "description", content: "..." },
    { property: "og:title", content: "..." },

    // SEOé–¢é€£ã®<links>ã‚‚è¿½åŠ ã§ãã¾ã™
    { tagName: "link", rel: "canonical", href: "..." },

    // <script type=ld+json>ã‚‚è¿½åŠ ã§ãã¾ã™
    {
      "script:ld+json": {
        some: "value",
      },
    },
  ];
}
```

#### `matches`å¼•æ•°

v1ã§ã¯ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®è¿”ã‚Šå€¤ãŒã™ã¹ã¦ãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€now you'll need to manage the merge yourself with `matches`:

```tsx filename=app/routes/v2-route.tsx good
export function meta({ matches }) {
  const rootMeta = matches[0].meta;
  const title = rootMeta.find((m) => m.title);

  return [
    title,
    { name: "description", content: "..." },
    { property: "og:title", content: "..." },

    // SEOé–¢é€£ã®<links>ã‚‚è¿½åŠ ã§ãã¾ã™
    { tagName: "link", rel: "canonical", href: "..." },

    // <script type=ld+json>ã‚‚è¿½åŠ ã§ãã¾ã™
    {
      "script:ld+json": {
        "@context": "https://schema.org",
        "@type": "Organization",
        name: "Remix",
      },
    },
  ];
}
```

[meta][meta]ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ãƒ«ãƒ¼ãƒˆãƒ¡ã‚¿ã®ãƒãƒ¼ã‚¸ã«ã¤ã„ã¦ã®ãƒ’ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚

## `CatchBoundary`ã¨`ErrorBoundary`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_errorBoundary: true,
  },
};
```

v1ã§ã¯ã€æŠ•ã’ã‚‰ã‚ŒãŸ`Response`ãŒã‚‚ã£ã¨ã‚‚è¿‘ã„`CatchBoundary`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã—ãŸãŒã€ãã‚Œä»¥å¤–ã®æœªå‡¦ç†ã®ä¾‹å¤–ã¯`ErrorBoundary`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã„ã¾ã—ãŸã€‚v2ã§ã¯`CatchBoundary`ãŒãªãã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã‚ã‚Œä¾‹å¤–ã§ã‚ã‚Œã€ã™ã¹ã¦ã®æœªå‡¦ç†ã®ä¾‹å¤–ãŒ`ErrorBoundary`ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

ã•ã‚‰ã«ã€ã‚¨ãƒ©ãƒ¼ã¯ã‚‚ã¯ã‚„`ErrorBoundary`ã«ãƒ—ãƒ­ãƒƒãƒ—ã‚¹ã¨ã—ã¦æ¸¡ã•ã‚Œãšã€`useRouteError`ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useCatch } from "@remix-run/react";

export function CatchBoundary() {
  const caught = useCatch();

  return (
    <div>
      <h1>Oops</h1>
      <p>Status: {caught.status}</p>
      <p>{caught.data.message}</p>
    </div>
  );
}

export function ErrorBoundary({ error }) {
  console.error(error);
  return (
    <div>
      <h1>Uh oh ...</h1>
      <p>Something went wrong</p>
      <pre>{error.message || "Unknown error"}</pre>
    </div>
  );
}
```

å¤‰æ›´å¾Œ:

```tsx filename=app/routes/v2-route.tsx good
import {
  useRouteError,
  isRouteErrorResponse,
} from "@remix-run/react";

export function ErrorBoundary() {
  const error = useRouteError();

  // trueã®å ´åˆã€ã“ã‚Œã¾ã§`CatchBoundary`ã«æ¸¡ã•ã‚Œã¦ã„ãŸã‚‚ã®
  if (isRouteErrorResponse(error)) {
    return (
      <div>
        <h1>Oops</h1>
        <p>Status: {error.status}</p>
        <p>{error.data.message}</p>
      </div>
    );
  }

  // è‡ªèº«ã®ãƒ­ã‚¸ãƒƒã‚¯ã§ã‚¿ã‚¤ãƒ—ãƒã‚§ãƒƒã‚¯ã‚’å¿˜ã‚Œãšã«ã€‚
  // æŠ•ã’ã‚‰ã‚Œã‚‹å€¤ã¯ã‚¨ãƒ©ãƒ¼ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“!
  let errorMessage = "Unknown error";
  if (isDefinitelyAnError(error)) {
    errorMessage = error.message;
  }

  return (
    <div>
      <h1>Uh oh ...</h1>
      <p>Something went wrong.</p>
      <pre>{errorMessage}</pre>
    </div>
  );
}
```

## `formMethod`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  future: {
    v2_normalizeFormMethod: true,
  },
};
```

è¤‡æ•°ã®APIãŒ`formMethod`ã‚’è¿”ã—ã¾ã™ãŒã€v1ã§ã¯å°æ–‡å­—ã®ãƒ¡ã‚½ãƒƒãƒ‰åãŒè¿”ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚v2ã§ã¯HTTPã¨fetchä»•æ§˜ã«åˆã‚ã›ã¦ã€å¤§æ–‡å­—ã®ãƒ¡ã‚½ãƒƒãƒ‰åãŒè¿”ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```tsx
function Something() {
  const navigation = useNavigation();

  // v1
  navigation.formMethod === "post";

  // v2
  navigation.formMethod === "POST";
}

export function shouldRevalidate({ formMethod }) {
  // v1
  formMethod === "post";

  // v2
  formMethod === "POST";
}
```

## `useTransition`

ã“ã®ãƒ•ãƒƒã‚¯ã¯æœ€è¿‘Reactã§åŒåã®ãƒ•ãƒƒã‚¯ãŒç™»å ´ã—ãŸãŸã‚ã€`useNavigation`ã«åç§°ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ã¾ãŸã€`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªããªã‚Šã€`submission`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ`navigation`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¹³å¦åŒ–ã•ã‚Œã¾ã—ãŸã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useTransition } from "@remix-run/react";

function SomeComponent() {
  const transition = useTransition();
  transition.submission.formData;
  transition.submission.formMethod;
  transition.submission.formAction;
  transition.type;
}
```

```tsx filename=app/routes/v2-route.tsx good
import { useNavigation } from "@remix-run/react";

function SomeComponent() {
  const navigation = useNavigation();

  // transition.submissionã®ã‚­ãƒ¼ãŒ`navigation[key]`ã«å¹³å¦åŒ–ã•ã‚Œã¾ã™
  navigation.formData;
  navigation.formMethod;
  navigation.formAction;

  // ã“ã®ã‚­ãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸ
  navigation.type;
}
```

ä»¥å‰ã®`transition.type`ã‚’å°å‡ºã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªä¾‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚ã‚ˆã‚Šç°¡å˜ãªæ–¹æ³•ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚é€šå¸¸ã€`navigation.state`ã€`navigation.formData`ã€ã¾ãŸã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è¿”ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’`useActionData`ã§å–å¾—ã™ã‚‹ã“ã¨ã§ã€æ±‚ã‚ã‚‹UXã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚Discordã§è³ªå•ã—ã¦ãã ã•ã„ã€‚ã‚µãƒã•ã›ã¦ã„ãŸã ãã¾ã™ :D

```tsx
function Component() {
  const navigation = useNavigation();

  // transition.type === "actionSubmission"
  const isActionSubmission =
    navigation.state === "submitting";

  // transition.type === "actionReload"
  const isActionReload =
    navigation.state === "loading" &&
    navigation.formMethod != null &&
    navigation.formMethod != "GET" &&
    // é€ä¿¡ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€é€ä¿¡ã•ã‚ŒãŸãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹
    navigation.formAction === navigation.location.pathname;

  // transition.type === "actionRedirect"
  const isActionRedirect =
    navigation.state === "loading" &&
    navigation.formMethod != null &&
    navigation.formMethod != "GET" &&
    // é€ä¿¡ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€åˆ¥ã®ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã¦ã„ã‚‹
    navigation.formAction !== navigation.location.pathname;

  // transition.type === "loaderSubmission"
  const isLoaderSubmission =
    navigation.state === "loading" &&
    navigation.state.formMethod === "GET" &&
    // ãƒ­ãƒ¼ãƒ€ãƒ¼é€ä¿¡ãŒã‚ã‚Šã€é€ä¿¡ã•ã‚ŒãŸãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã¦ã„ã‚‹
    navigation.formAction === navigation.location.pathname;

  // transition.type === "loaderSubmissionRedirect"
  const isLoaderSubmissionRedirect =
    navigation.state === "loading" &&
    navigation.state.formMethod === "GET" &&
    // ãƒ­ãƒ¼ãƒ€ãƒ¼é€ä¿¡ãŒã‚ã‚Šã€æ–°ã—ã„ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã¦ã„ã‚‹
    navigation.formAction !== navigation.location.pathname;
}
```

**GETã®é€ä¿¡ã«ã¤ã„ã¦**

Remix v1ã§ã¯ã€`<Form method="get">`ã‚„`submit({}, { method: 'get' })`ã®ã‚ˆã†ãªGETé€ä¿¡ã¯ã€`transition.state`ã§ `idle -> submitting -> idle`ã®ã‚ˆã†ã«é·ç§»ã—ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯å®Œå…¨ã«æ„å‘³çš„ã«æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ "é€ä¿¡"ã¯ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€GETãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€ãƒ­ãƒ¼ãƒ€ãƒ¼ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã ã‘ã ã‹ã‚‰ã§ã™ã€‚æ©Ÿèƒ½çš„ã«ã¯ã€`<Link>`ã‚„`navigate()`ã¨ä½•ã‚‚å¤‰ã‚ã‚Šã¾ã›ã‚“ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä»‹ã—ã¦æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’æŒ‡å®šã§ãã‚‹ã ã‘ã§ã™ã€‚

v2ã§ã¯ã€GETé€ä¿¡ãŒã‚ˆã‚Šæ­£ç¢ºã« "ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³" ã¨ã—ã¦åæ˜ ã•ã‚Œã€é€šå¸¸ã®ãƒªãƒ³ã‚¯ã¨åŒæ§˜ã«`idle -> loading -> idle`ã¨é·ç§»ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚GETé€ä¿¡ãŒ`<Form>`ã‚„`submit()`ã‹ã‚‰æ¥ã¦ã„ã‚‹å ´åˆã¯ã€`useNavigation.form*`ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦åŒºåˆ¥ã§ãã¾ã™ã€‚

## `useFetcher`

`useNavigation`ã¨åŒæ§˜ã«ã€`useFetcher`ã§ã‚‚`submission`ãŒå¹³å¦åŒ–ã•ã‚Œã€`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚

```tsx bad filename=app/routes/v1-route.tsx
import { useFetcher } from "@remix-run/react";

function SomeComponent() {
  const fetcher = useFetcher();
  fetcher.submission.formData;
  fetcher.submission.formMethod;
  fetcher.submission.formAction;
  fetcher.type;
}
```

```tsx filename=app/routes/v2-route.tsx good
import { useFetcher } from "@remix-run/react";

function SomeComponent() {
  const fetcher = useFetcher();

  // ã“ã‚Œã‚‰ã®ã‚­ãƒ¼ãŒå¹³å¦åŒ–ã•ã‚Œã¾ã—ãŸ
  fetcher.formData;
  fetcher.formMethod;
  fetcher.formAction;

  // ã“ã®ã‚­ãƒ¼ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸ
  fetcher.type;
}
```

ä»¥å‰ã®`fetcher.type`ã‚’å°å‡ºã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªä¾‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚ã‚ˆã‚Šç°¡å˜ãªæ–¹æ³•ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚é€šå¸¸ã€`fetcher.state`ã€`fetcher.formData`ã€ã¾ãŸã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰è¿”ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’`fetcher.data`ã§å–å¾—ã™ã‚‹ã“ã¨ã§ã€æ±‚ã‚ã‚‹UXã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚Discordã§è³ªå•ã—ã¦ãã ã•ã„ã€‚ã‚µãƒã•ã›ã¦ã„ãŸã ãã¾ã™ :D

```tsx
function Component() {
  const fetcher = useFetcher();

  // fetcher.type === "init"
  const isInit =
    fetcher.state === "idle" && fetcher.data == null;

  // fetcher.type === "done"
  const isDone =
    fetcher.state === "idle" && fetcher.data != null;

  // fetcher.type === "actionSubmission"
  const isActionSubmission = fetcher.state === "submitting";

  // fetcher.type === "actionReload"
  const isActionReload =
    fetcher.state === "loading" &&
    fetcher.formMethod != null &&
    fetcher.formMethod != "GET" &&
    // ãƒ‡ãƒ¼ã‚¿ãŒè¿”ã•ã‚ŒãŸå ´åˆã€ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã¯ãš
    fetcher.data != null;

  // fetcher.type === "actionRedirect"
  const isActionRedirect =
    fetcher.state === "loading" &&
    fetcher.formMethod != null &&
    fetcher.formMethod != "GET" &&
    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã¯ãš
    fetcher.data == null;

  // fetcher.type === "loaderSubmission"
  const isLoaderSubmission =
    fetcher.state === "loading" &&
    fetcher.formMethod === "GET";

  // fetcher.type === "normalLoad"
  const isNormalLoad =
    fetcher.state === "loading" &&
    fetcher.formMethod == null;
}
```

**GETã®é€ä¿¡ã«ã¤ã„ã¦**

Remix v1ã§ã¯ã€`<fetcher.Form method="get">`ã‚„`fetcher.submit({}, { method: 'get' })`ã®ã‚ˆã†ãªGETé€ä¿¡ã¯ã€`fetcher.state`ã§ `idle -> submitting -> idle`ã®ã‚ˆã†ã«é·ç§»ã—ã¦ã„ã¾ã—ãŸã€‚ã“ã‚Œã¯å®Œå…¨ã«æ„å‘³çš„ã«æ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ "é€ä¿¡"ã¯ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã€GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€ãƒ­ãƒ¼ãƒ€ãƒ¼ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã ã‘ã ã‹ã‚‰ã§ã™ã€‚æ©Ÿèƒ½çš„ã«ã¯ã€`fetcher.load()`ã¨ä½•ã‚‚å¤‰ã‚ã‚Šã¾ã›ã‚“ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä»‹ã—ã¦æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’æŒ‡å®šã§ãã‚‹ã ã‘ã§ã™ã€‚

v2ã§ã¯ã€GETé€ä¿¡ãŒã‚ˆã‚Šæ­£ç¢ºã« "ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ" ã¨ã—ã¦åæ˜ ã•ã‚Œã€é€šå¸¸ã®fetcherãƒ­ãƒ¼ãƒ‰ã¨åŒæ§˜ã«`idle -> loading -> idle`ã¨é·ç§»ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚GETé€ä¿¡ãŒ`<fetcher.Form>`ã‚„`fetcher.submit()`ã‹ã‚‰æ¥ã¦ã„ã‚‹å ´åˆã¯ã€`fetcher.form*`ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦åŒºåˆ¥ã§ãã¾ã™ã€‚

## Linksã® `imagesizes` ã¨ `imagesrcset`

ãƒ«ãƒ¼ãƒˆã® `links`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€HTML ã®å°æ–‡å­—ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯ãªãã€Reactã® camelCase å€¤ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰2ã¤ã®å€¤ãŒv1ã§ã¯å°æ–‡å­—ã§å…¥ã‚Šè¾¼ã‚“ã§ã„ã¾ã—ãŸã€‚v2ã§ã¯ã€camelCaseãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿ãŒæœ‰åŠ¹ã§ã™:

```tsx bad filename=app/routes/v1-route.tsx
export const links: LinksFunction = () => {
  return [
    {
      rel: "preload",
      as: "image",
      imagesrcset: "...",
      imagesizes: "...",
    },
  ];
};
```

```tsx filename=app/routes/v2-route.tsx good
export const links: V2_LinksFunction = () => {
  return [
    {
      rel: "preload",
      as: "image",
      imageSrcSet: "...",
      imageSizes: "...",
    },
  ];
};
```

## `browserBuildDirectory`

`remix.config.js`ã§ã€`browserBuildDirectory`ã‚’`assetsBuildDirectory`ã«åç§°å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```js bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserBuildDirectory: "./public/build",
};
```

```js filename=remix.config.js good lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  assetsBuildDirectory: "./public/build",
};
```


## `devServerBroadcastDelay`

ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã®å•é¡Œã‚’è§£æ±ºã—ãŸãŸã‚ã€`remix.config.js`ã‹ã‚‰`devServerBroadcastDelay`ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

```diff filename=remix.config.js
  /** @type {import('@remix-run/dev').AppConfig} */
  module.exports = {
-   devServerBroadcastDelay: 300,
  };
```

## `devServerPort`

`remix.config.js`ã§ã€`devServerPort`ã‚’`future.v2_dev.port`ã«åç§°å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```js bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  devServerPort: 8002,
};
```

```js filename=remix.config.js good lines=[3-7]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  // v1.xä¸­ã¯ future ãƒ•ãƒ©ã‚°ã‚’ä½¿ã„ã¾ã™
  future: {
    v2_dev: {
      port: 8002,
    },
  },
};
```

v1ã‹ã‚‰v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¨ã€ã“ã‚Œã¯[ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®`dev`è¨­å®šã«å¹³å¦åŒ–][dev-after-upgrading]ã•ã‚Œã¾ã™ã€‚

## `serverBuildDirectory`

`remix.config.js`ã§ã€`serverBuildDirectory`ã‚’`serverBuildPath`ã«åç§°å¤‰æ›´ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ‘ã‚¹ã§ã¯ãªããƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

```js bad filename=remix.config.js lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverBuildDirectory: "./build",
};
```

```js filename=remix.config.js good lines=[3]
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverBuildPath: "./build/index.js",
};
```

Remix ã¯ä»¥å‰ã€ã‚µãƒ¼ãƒãƒ¼ç”¨ã«è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸãŒã€ç¾åœ¨ã¯å˜ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

## `serverBuildTarget`

ãƒ“ãƒ«ãƒ‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹ä»£ã‚ã‚Šã«ã€`remix.config.js`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã®ãƒ“ãƒ«ãƒ‰ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«åˆã†ã‚ˆã†ã«ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€RemixãŒã‚ˆã‚Šå¤šãã®JavaScriptãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ã‚µãƒ¼ãƒãƒ¼ã€ãƒ›ã‚¹ãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ç¾åœ¨ã®`serverBuildTarget`ã¯ä»¥ä¸‹ã®è¨­å®šã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã¯ãšã§ã™:

#### `arc`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/_static/build/",
  serverBuildPath: "server/index.js",
  serverMainFields: ["main", "module"], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverModuleFormat: "cjs", // 1.xã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«è¿½åŠ 
  serverPlatform: "node", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
};
```

#### `cloudflare-pages`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverBuildPath: "functions/[[path]].js",
  serverConditions: ["worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["browser", "module", "main"],
  serverMinify: true,
  serverModuleFormat: "esm", // 2.xã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã¯å‰Šé™¤å¯èƒ½
  serverPlatform: "neutral",
};
```

#### `cloudflare-workers`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverConditions: ["worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["browser", "module", "main"],
  serverMinify: true,
  serverModuleFormat: "esm", // 2.xã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã¯å‰Šé™¤å¯èƒ½
  serverPlatform: "neutral",
};
```

#### `deno`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverConditions: ["deno", "worker"],
  serverDependenciesToBundle: "all",
  serverMainFields: ["module", "main"],
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverModuleFormat: "esm", // 2.xã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã¯å‰Šé™¤å¯èƒ½
  serverPlatform: "neutral",
};
```

#### `node-cjs`

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  publicPath: "/build/", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverBuildPath: "build/index.js", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverMainFields: ["main", "module"], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverMinify: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
  serverModuleFormat: "cjs", // 1.xã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‰ã«è¿½åŠ 
  serverPlatform: "node", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã€å‰Šé™¤å¯èƒ½
};
```

## `serverModuleFormat`

ã‚µãƒ¼ãƒãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒ`cjs`ã‹ã‚‰`esm`ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚v2ã§ã‚‚å¼•ãç¶šãCJSã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã®ä¾å­˜é–¢ä¿‚ã®å¤šããŒESMã«å¯¾å¿œã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

`remix.config.js`ã§ã€`serverModuleFormat: "cjs"`ã‚’æŒ‡å®šã—ã¦æ—¢å­˜ã®å‹•ä½œã‚’ç¶­æŒã™ã‚‹ã‹ã€`serverModuleFormat: "esm"`ã‚’æŒ‡å®šã—ã¦æ–°ã—ã„å‹•ä½œã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## `browserNodeBuiltinsPolyfill`

Node.jsçµ„ã¿è¾¼ã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒªãƒ•ã‚£ãƒ«ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ–ãƒ©ã‚¦ã‚¶ã«ã¯æä¾›ã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚Remix v2ã§ã¯ã€å¿…è¦ã«å¿œã˜ã¦æ˜ç¤ºçš„ã«ãƒãƒªãƒ•ã‚£ãƒ«ã‚’å†å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserNodeBuiltinsPolyfill: {
    modules: {
      buffer: true,
      fs: "empty",
    },
    globals: {
      Buffer: true,
    },
  },
};
```

ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒ³ãƒ‰ãƒ«ã§ã¯ä¸€éƒ¨ã®ãƒãƒªãƒ•ã‚£ãƒ«ãŒéå¸¸ã«å¤§ãã„ãŸã‚ã€æ˜ç¤ºçš„ã«ãƒãƒªãƒ•ã‚£ãƒ«ã‚’è¨±å¯ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ãŒã€Remix v1ã®ãƒ•ãƒ«è¨­å®šã‚’å³åº§ã«å¾©å…ƒã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:

```js filename=remix.config.js
const { builtinModules } = require("node:module");

/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  browserNodeBuiltinsPolyfill: {
    modules: builtinModules,
  },
};
```

## `serverNodeBuiltinsPolyfill`

Node.jsçµ„ã¿è¾¼ã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒªãƒ•ã‚£ãƒ«ã¯ã€Node.jsä»¥å¤–ã®ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æä¾›ã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚

Node.jsä»¥å¤–ã®ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¦ãŠã‚Šã€v1ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œã«åˆ‡ã‚Šæ›¿ãˆãŸã„å ´åˆã€`remix.config.js`ã§`serverNodeBuiltinsPolyfill.modules`ã‚’ç©ºã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã‚‹ã“ã¨ã§ã€ã™ã¹ã¦ã®ã‚µãƒ¼ãƒãƒ¼ãƒãƒªãƒ•ã‚£ãƒ«ã‚’å‰Šé™¤ã§ãã¾ã™:

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverNodeBuiltinsPolyfill: {
    modules: {},
  },
};
```

ãã®å¾Œã€å¿…è¦ã«å¿œã˜ã¦ä»»æ„ã®ãƒãƒªãƒ•ã‚£ãƒ«(ã¾ãŸã¯ç©ºã®ãƒãƒªãƒ•ã‚£ãƒ«)ã‚’å†å°å…¥ã§ãã¾ã™ã€‚

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverNodeBuiltinsPolyfill: {
    modules: {
      buffer: true,
      fs: "empty",
    },
    globals: {
      Buffer: true,
    },
  },
};
```

å‚è€ƒã¾ã§ã«ã€v1ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒªãƒ•ã‚£ãƒ«å…¨ä½“ã‚’æ‰‹å‹•ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  serverNodeBuiltinsPolyfill: {
    modules: {
      _stream_duplex: true,
      _stream_passthrough: true,
      _stream_readable: true,
      _stream_transform: true,
      _stream_writable: true,
      assert: true,
      "assert/strict": true,
      buffer: true,
      console: true,
      constants: true,
      crypto: "empty",
      diagnostics_channel: true,
      domain: true,
      events: true,
      fs: "empty",
      "fs/promises": "empty",
      http: true,
      https: true,
      module: true,
      os: true,
      path: true,
      "path/posix": true,
      "path/win32": true,
      perf_hooks: true,
      process: true,
      punycode: true,
      querystring: true,
      stream: true,
      "stream/promises": true,
      "stream/web": true,
      string_decoder: true,
      sys: true,
      timers: true,
      "timers/promises": true,
      tty: true,
      url: true,
      util: true,
      "util/types": true,
      vm: true,
      wasi: true,
      worker_threads: true,
      zlib: true,
    },
  },
};
```

## `installGlobals`

Nodeå†…è”µã®fetchã®å®Ÿè£…ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™ã¨ã—ã¦ã€fetchã‚°ãƒ­ãƒ¼ãƒãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã®è²¬ä»»ã«ãªã‚Šã¾ã—ãŸã€‚`remix-serve`ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€è‡ªåˆ†ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```ts filename=server.ts
import { installGlobals } from "@remix-run/node";

installGlobals();
```

### ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒãƒªãƒ•ã‚£ãƒ«ã®å‰Šé™¤

Remix v2ã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒãƒªãƒ•ã‚£ãƒ«ã•ã‚ŒãŸå®Ÿè£…ã‚’`@remix-run/node`ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãªããªã‚Šã¾ã—ãŸã€‚ä»£ã‚ã‚Šã«ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã®å®Ÿè£…ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒå½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å ´æ‰€ã¯ã€`app/entry.server.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ã“ã“ã§`PassThrough`ã‚’`ReadableStream`ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:

```diff filename=app/entry.server.tsx
  import { PassThrough } from "node:stream";
  import type { AppLoadContext, EntryContext } from "@remix-run/node"; // or cloudflare/deno
- import { Response } from "@remix-run/node"; // or cloudflare/deno
+ import { createReadableStreamFromReadable } from "@remix-run/node"; // or cloudflare/deno
  import { RemixServer } from "@remix-run/react";
  import { isbot } from "isbot";
  import { renderToPipeableStream } from "react-dom/server";

  const ABORT_DELAY = 5_000;

  export default function handleRequest({ /* ... */ }) { ... }

  function handleBotRequest(...) {
    return new Promise((resolve, reject) => {
      let shellRendered = false;
      const { pipe, abort } = renderToPipeableStream(
        <RemixServer ... />,
        {
          onAllReady() {
            shellRendered = true;
            const body = new PassThrough();

            responseHeaders.set("Content-Type", "text/html");

            resolve(
-             new Response(body, {
+             new Response(createReadableStreamFromReadable(body), {
                headers: responseHeaders,
                status: responseStatusCode,
              })
            );

            pipe(body);
          },
          ...
          onShellError(error: unknown) { ... }
          onError(error: unknown) { ... }
        }
      );

      setTimeout(abort, ABORT_DELAY);
    });
  }

  function handleBrowserRequest(...) {
    return new Promise((resolve, reject) => {
      let shellRendered = false;
      const { pipe, abort } = renderToPipeableStream(
        <RemixServer ... />,
        {
          onShellReady() {
            shellRendered = true;
            const body = new PassThrough();

            responseHeaders.set("Content-Type", "text/html");

            resolve(
-              new Response(body, {
+              new Response(createReadableStreamFromReadable(body), {
                headers: responseHeaders,
                status: responseStatusCode,
              })
            );

            pipe(body);
          },
          onShellError(error: unknown) { ... },
          onError(error: unknown) { ... },
        }
      );

      setTimeout(abort, ABORT_DELAY);
    });
  }
```

## `source-map-support`

ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚µãƒãƒ¼ãƒˆã¯ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã®è²¬ä»»ã«ãªã‚Šã¾ã—ãŸã€‚`remix-serve`ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€è‡ªåˆ†ã§ [`source-map-support`][source-map-support]ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shellscript nonumber
npm i source-map-support
```

```ts filename=server.ts
import sourceMapSupport from "source-map-support";

sourceMapSupport.install();
```

## Netlifyã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼

`@remix-run/netlify`ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ã€[`@netlify/remix-adapter`][official-netlify-adapter]ã¨ [`@netlify/remix-edge-adapter`][official-netlify-edge-adapter]ã«éæ¨å¥¨ã¨ãªã‚Šã€Remix v2ã§å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ã™ã¹ã¦ã®`@remix-run/netlify`ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’`@netlify/remix-adapter`ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
`@netlify/remix-adapter`ã¯`@netlify/functions@^1.0.0`ã‚’è¦æ±‚ã™ã‚‹ãŸã‚ã€`@remix-run/netlify`ã§ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹`@netlify/functions`ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ç ´å£Šçš„ãªå¤‰æ›´ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ã“ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å‰Šé™¤ã«ä¼´ã„ã€[Netlifyãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][netlify-template]ã‚‚[å…¬å¼ã®Netlifyãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][official-netlify-template]ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚


## Vercelã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼

`@remix-run/vercel`ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ã€Vercelã®æ¨™æº–æ©Ÿèƒ½ã«éæ¨å¥¨ã¨ãªã‚Šã€Remix v2ã§å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚`package.json`ã‹ã‚‰`@remix-run/vercel`ã¨`@vercel/node`ã‚’å‰Šé™¤ã—ã€`server.js`/`server.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã€`remix.config.js`ã®`server`ã¨`serverBuildPath`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚

ã“ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®å‰Šé™¤ã«ä¼´ã„ã€[Vercelãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][vercel-template]ã‚‚[å…¬å¼ã®Vercelãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ][official-vercel-template]ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

## çµ„ã¿è¾¼ã¿ã®PostCSS/Tailwind ã‚µãƒãƒ¼ãƒˆ

v2ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«PostCSSã‚„ Tailwindã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã€ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ãŒRemixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å†…ã§è‡ªå‹•çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

Remixã¨ã¯åˆ¥ã«ã‚«ã‚¹ã‚¿ãƒ ã®PostCSSã‚„Tailwindã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ç¶­æŒã—ãŸã„å ´åˆã¯ã€`remix.config.js`ã§ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’ç„¡åŠ¹ã«ã§ãã¾ã™ã€‚

```js filename=remix.config.js
/** @type {import('@remix-run/dev').AppConfig} */
module.exports = {
  postcss: false,
  tailwind: false,
};
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ESM / CommonJSã®ã‚¨ãƒ©ãƒ¼

```sh
"SyntaxError: Named export '<something>' not found. The requested module '<something>' is a CommonJS module, which may not support all module.exports as named exports."
```

[`serverModuleFormat`][server-module-format]ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[classic-remix-compiler]: ../guides/vite#ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªRemixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©vsRemixã®Vite
[remix-vite]: ../guides/vite
[future-flags]: ./future-flags
[remix_config]: ../file-conventions/remix-config
[pass_through_class]: https://nodejs.org/api/stream.html#class-streampassthrough
[readable_stream]: https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream
[flat-routes]: https://github.com/remix-run/remix/discussions/4482
[meta]: ../route/meta
[meta-v2-rfc]: https://github.com/remix-run/remix/discussions/4462
[meta-v2-matches]: #the-matches-argument
[templates]: https://github.com/remix-run/remix/tree/main/templates
[dev-docs]: ../other-api/dev
[manual-mode]: ../guides/manual-mode
[source-map-support]: https://npm.im/source-map-support
[official-netlify-adapter]: https://github.com/netlify/remix-compute/tree/main/packages/remix-adapter
[official-netlify-edge-adapter]: https://github.com/netlify/remix-compute/tree/main/packages/remix-edge-adapter
[netlify-template]: https://github.com/remix-run/remix/tree/main/templates/netlify
[official-netlify-template]: https://github.com/netlify/remix-template
[vercel-template]: https://github.com/remix-run/remix/tree/main/templates/vercel
[official-vercel-template]: https://github.com/vercel/vercel/tree/main/examples/remix
[troubleshooting]: #ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
[server-module-format]: #servermoduleformat
[2-min-to-v2]: https://twitter.com/BrooksLybrand/status/1704265835546578989
[dev-after-upgrading]: #v1ã‹ã‚‰v2ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸå¾Œ
