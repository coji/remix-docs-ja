---
title: ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
new: true
---

# ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

Remix v1 ã®ãƒªãƒªãƒ¼ã‚¹ä»¥é™ã€ç§ãŸã¡ãŒæœ€ã‚‚é »ç¹ã«å—ã‘ã‚‹è³ªå•ã® 1 ã¤ã¯ã€ã€ŒRemix ã§ã©ã®ã‚ˆã†ã«ã‚¢ãƒ—ãƒªã‚’ SSG ã§ãã¾ã™ã‹ï¼Ÿã€ã§ã™ã€‚

ç§ãŸã¡ã¯é•·ã„é–“ï¼ˆãã—ã¦ä»Šã§ã‚‚ï¼‰ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚µãƒ¼ãƒãƒ¼ã‚’æŒã¤ã“ã¨ãŒã€ã»ã¨ã‚“ã©ã®ã‚¢ãƒ—ãƒªã«ã¨ã£ã¦æœ€é«˜ã® UX/ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹/SEO ãªã©ã‚’å®Ÿç¾ã™ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯è‡ªåˆ†è‡ªèº«ã§æ‰€æœ‰ã™ã¹ãã§ã‚ã‚Šã€ç¾å®Ÿä¸–ç•Œã«ã¯ã€é™çš„ã«ç”Ÿæˆã•ã‚ŒãŸã‚µã‚¤ãƒˆï¼ˆä»¥é™ã€ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚µã‚¤ãƒˆã¨å‘¼ã³ã¾ã™ ğŸ˜‰ï¼‰ã«é©ã—ãŸãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒæ•°å¤šãå­˜åœ¨ã™ã‚‹ã“ã¨ã¯æ˜ã‚‰ã‹ã§ã™ã€‚

ç§ãŸã¡ã¯ã—ã°ã‚‰ãã®é–“ã€ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ Remix/React Router ã®ç¬¬ä¸€ç´šæ©Ÿèƒ½ã«ã™ã‚‹å¿…è¦ã¯ãªã„ã¨è€ƒãˆã¦ãã¾ã—ãŸï¼ˆãã—ã¦ä»Šã§ã‚‚ãã†æ€ã£ã¦ã„ã¾ã™ï¼‰ã€‚ã‚ãªãŸã¯ [ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ãƒ³ãƒ‰ã§ã“ã‚Œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™][michael-tweet]ã€‚[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿][client-data] ã®è¿½åŠ ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§è¡Œã†ã“ã¨ãŒã§ãã‚‹ã“ã¨ãŒã•ã‚‰ã«å¼·åŠ›ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€[ã•ã¾ã–ã¾ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£][remix-ssg] ã‚’é¸æŠã§ãã¾ã™ã€‚

ã—ã‹ã—ã€[ã‚·ãƒ³ã‚°ãƒ«ãƒ•ã‚§ãƒƒãƒ][single-fetch] ã‚’å°å…¥ã™ã‚‹ã¾ã§ã¯ã€ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®çœŸã®åŠ›ã¯è§£æ”¾ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ä»¥å‰ã¯ã€SPA ã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã—ãŸãŒã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«ã¯ `clientLoader` ã®ä½¿ç”¨ã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ã‚·ãƒ³ã‚°ãƒ«ãƒ•ã‚§ãƒƒãƒã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€HTML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€åŒæ™‚ã«ãƒ“ãƒ«ãƒ‰æ™‚ã« `loader` é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ `.data` ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¢ãƒ—ãƒªã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®é·ç§»ä¸­ã«ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã¾ã™ã€‚

ã“ã‚Œã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ãƒ³ãƒ‰ã§ã‚‚å®Œå…¨ã«å®Ÿè¡Œã§ãã‚‹ã“ã¨ã§ã™ãŒã€é »ç¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã‚‹ãŸã‚ã€å°‚ç”¨ã®çµ„ã¿è¾¼ã¿ API ã‚’æä¾›ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## è¨­å®š

ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€React Router Vite ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã« `prerender` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

æœ€ã‚‚å˜ç´”ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã¯ã€`prerender: true` ã¨ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å®šç¾©ã•ã‚ŒãŸã™ã¹ã¦ã®é™çš„ãƒ«ãƒ¼ãƒˆï¼ˆå‹•çš„ã¾ãŸã¯ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€ãƒ‘ã‚¹ã‚’é™¤ãï¼‰ãŒãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

```ts filename=vite.config.ts
import { reactRouter } from "@react-router/dev/vite";
import { defineConfig } from "vite";

export default defineConfig({
  plugins: [
    reactRouter({
      prerender: true,
    }),
  ],
});
```

å‹•çš„/ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€ãƒ‘ã‚¹ã‚’ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€ã¾ãŸã¯é™çš„ãƒ‘ã‚¹ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã®ã¿ã‚’ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ãƒ‘ã‚¹ã®é…åˆ—ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

```ts filename=vite.config.ts
import { reactRouter } from "@react-router/dev/vite";
import { defineConfig } from "vite";

export default defineConfig({
  plugins: [
    reactRouter({
      prerender: ["/", "/blog"],
    }),
  ],
});
```

`prerender` ã¯é–¢æ•°ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã€ã“ã‚Œã«ã‚ˆã‚Šã€ãŸã¨ãˆã° CMS ã‹ã‚‰ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã‚’å–å¾—ã—ãŸå¾Œã€ãƒ‘ã‚¹ã‚’å‹•çš„ã«ç”Ÿæˆã§ãã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å®šç¾©ã•ã‚ŒãŸã™ã¹ã¦ã®é™çš„ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ `getStaticPaths` é–¢æ•°ã‚’å«ã‚€å˜ä¸€ã®å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

```ts filename=vite.config.ts
import { reactRouter } from "@react-router/dev/vite";
import { defineConfig } from "vite";

export default defineConfig({
  plugins: [
    reactRouter({
      async prerender({ getStaticPaths }) {
        let slugs = await getSlugsFromCms();
        return [
          ...getStaticPaths(),
          ...slugs.map((s) => `/blog/${s}`),
        ];
      },
    }),
  ],
});
```

## é–‹ç™º

`react-router dev` ã‚’ä½¿ç”¨ã—ã¦é–‹ç™ºã—ã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦ã‚‚ä½•ã‚‚å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚HMR/HDR ã®é–‹ç™ºè€…ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®åˆ©ç‚¹ã‚’å¾—ã‚‹ãŸã‚ã«ã€vite dev ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ç¶šã‘ã¾ã™ã€‚ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã®ã¿ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚

## ãƒ“ãƒ«ãƒ‰

ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¦ `react-router build` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚µãƒ¼ãƒãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã€`prerender` ã§æŒ‡å®šã—ãŸã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã«å¯¾ã—ã¦å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ç”Ÿæˆã•ã‚ŒãŸ HTML ã¯ `build/client` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›ã•ã‚Œã€ã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒˆã®ã„ãšã‚Œã‹ã«ãƒ­ãƒ¼ãƒ€ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãƒ­ãƒ¼ãƒ€ãƒ¼ãŒå‘¼ã³å‡ºã•ã‚Œã€Single Fetch ã® `.data` ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `build/client` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

ãƒ“ãƒ«ãƒ‰ã®å‡ºåŠ›ã«ã¯ã€ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒç¤ºã•ã‚Œã¾ã™ã€‚

```sh
> react-router build
vite v5.2.11 building for production...
...
vite v5.2.11 building SSR bundle for production...
...
Prerender: Generated build/client/index.html
Prerender: Generated build/client/blog.data
Prerender: Generated build/client/blog/index.html
Prerender: Generated build/client/blog/my-first-post.data
Prerender: Generated build/client/blog/my-first-post/index.html
...
```

## ãƒ‡ãƒ—ãƒ­ã‚¤/ã‚µãƒ¼ãƒ“ã‚¹

ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ãŸã‚µã‚¤ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ã€è¤‡æ•°ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚

### é™çš„ãƒ‡ãƒ—ãƒ­ã‚¤

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®ãƒ‘ã‚¹ã‚’ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸå ´åˆã¯ã€`build/client/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä»»æ„ã® CDN ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€SPA ã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒˆã•ã‚Œã‚‹å®Œå…¨ã«é™çš„ãªã‚µã‚¤ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«ã¯ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã€`clientLoader` ã¨ `clientAction` ã‚’ä»‹ã—ã¦å‹•çš„ãªãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰ã¨å¤‰æ›´ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

### react-router-serve ã‚’ä»‹ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€`react-router-serve` ã¯ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ [`express.static`][express-static] ã‚’ä»‹ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¨ä¸€è‡´ã—ãªã„ãƒ‘ã‚¹ã¯ Remix ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æ¸¡ã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ä¸€éƒ¨ã®ãƒ«ãƒ¼ãƒˆã‚’ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ä»–ã®ãƒ«ãƒ¼ãƒˆã‚’ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§å‹•çš„ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€`/blog/*` å†…ã®ã™ã¹ã¦ã®ã‚‚ã®ã‚’ãƒ—ãƒªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€`/auth/*` å†…ã®ã™ã¹ã¦ã®ã‚‚ã®ã‚’ã‚µãƒ¼ãƒãƒ¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚

### æ‰‹å‹•ã‚µãƒ¼ãƒãƒ¼è¨­å®š

ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚ˆã‚Šç´°ã‹ãåˆ¶å¾¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ç‹¬è‡ªã®ã‚µãƒ¼ãƒãƒ¼ã§ã“ã‚Œã‚‰ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ã‚»ãƒƒãƒˆã®ã‚ˆã†ã«ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã§ãã¾ã™ã€‚ãŸã ã—ã€ãƒãƒƒã‚·ãƒ¥ã•ã‚ŒãŸé™çš„ã‚¢ã‚»ãƒƒãƒˆã¨é™çš„ãª `.html`/`.data` ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’åŒºåˆ¥ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

```js
// ãƒãƒƒã‚·ãƒ¥ã•ã‚ŒãŸé™çš„ã‚¢ã‚»ãƒƒãƒˆï¼ˆJS/CSS ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼‰ã‚’ã€æœ‰åŠ¹æœŸé™ãŒé•·ã„ Cache-Control ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã™ã‚‹
app.use(
  "/assets",
  express.static("build/client/assets", {
    immutable: true,
    maxAge: "1y",
  })
);

// é™çš„ HTML ã¨ .data ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€Cache-Control ãªã—ã§ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã™ã‚‹
app.use(
  "/",
  express.static("build/client", {
    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª index.html ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã€æœ«å°¾ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’å«ã‚ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãªã„
    redirect: false,
    setHeaders: function (res, path) {
      // ã‚¿ãƒ¼ãƒœã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é©åˆ‡ãª Content-Type ã‚’è¿½åŠ ã™ã‚‹
      if (path.endsWith(".data")) {
        res.set("Content-Type", "text/x-turbo");
      }
    },
  })
);

// æ®‹ã‚Šã®å‡¦ç†ã•ã‚Œã¦ã„ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ React Router ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã™ã‚‹
app.all(
  "*",
  createRequestHandler({
    build: await import("./build/server/index.js"),
  })
);
```

[michael-tweet]: https://twitter.com/mjackson/status/1585795441907494912
[client-data]: https://remix.run/docs/guides/client-data
[remix-ssg]: https://github.com/brophdawg11/remix-ssg
[single-fetch]: https://remix.run/docs/guides/single-fetch
[express-static]: https://expressjs.com/en/4x/api.html#express.static



