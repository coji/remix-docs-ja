---title: Suspense を使ったストリーミング---# Suspense を使ったストリーミング[MODES: framework, data]<br/><br/>React Suspense を使ったストリーミングにより、重要でないデータを遅延させ、UI レンダリングをブロック解除することで、アプリの初期レンダリングを高速化できます。React Router は、ローダーとアクションから Promise を返すことで、React Suspense をサポートします。## 1. ローダーから Promise を返すReact Router は、ルートコンポーネントをレンダリングする前にルートローダーを待機します。重要でないデータのローダーをブロック解除するには、ローダーで待機するのではなく、Promise を返します。```tsximport type { Route } from "./+types/my-route";export async function loader({}: Route.LoaderArgs) {  // これは待機されないことに注意してください  let nonCriticalData = new Promise((res) =>    setTimeout(() => res("non-critical"), 5000)  );  let criticalData = await new Promise((res) =>    setTimeout(() => res("critical"), 300)  );  return { nonCriticalData, criticalData };}```単一の Promise を返すことはできず、キーを持つオブジェクトである必要があることに注意してください。## 2. フォールバックと解決された UI をレンダリングするPromise は `loaderData` で利用可能になり、`<Await>` は Promise を待機し、`<Suspense>` がフォールバック UI をレンダリングするようにトリガーします。```tsximport * as React from "react";import { Await } from "react-router";// [previous code]export default function MyComponent({  loaderData,}: Route.ComponentProps) {  let { criticalData, nonCriticalData } = loaderData;  return (    <div>      <h1>ストリーミングの例</h1>      <h2>重要なデータの値: {criticalData}</h2>      <React.Suspense fallback={<div>読み込み中...</div>}>        <Await resolve={nonCriticalData}>          {(value) => <h3>重要でない値: {value}</h3>}        </Await>      </React.Suspense>    </div>  );}```## React 19 を使用する場合React 19 を試している場合は、`Await` の代わりに `React.use` を使用できますが、新しいコンポーネントを作成し、Promise を渡してサスペンスフォールバックをトリガーする必要があります。```tsx<React.Suspense fallback={<div>読み込み中...</div>}>  <NonCriticalUI p={nonCriticalData} /></React.Suspense>``````tsxfunction NonCriticalUI({ p }: { p: Promise<string> }) {  let value = React.use(p);  return <h3>重要でない値 {value}</h3>;}```## タイムアウトデフォルトでは、ローダーとアクションは 4950ms 後に未解決の Promise をすべて拒否します。これは、`entry.server.tsx` から数値の `streamTimeout` 値をエクスポートすることで制御できます。```ts filename=entry.server.tsx// ハンドラー関数からのすべての保留中の Promise を 10 秒後に拒否しますexport const streamTimeout = 10_000;```