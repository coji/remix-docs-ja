---
title: キャッシュコントロール
hidden: true
---

# キャッシュコントロール

## ルートモジュール内

各ルートはHTTPヘッダーを定義することもできます。これは主にHTTPキャッシュにとって重要です。Remixは、パフォーマンスのためにウェブサイトを静的ファイルにビルドしてCDNにアップロードすることに依存していません。代わりに、キャッシュヘッダーに依存しています。どちらのアプローチの結果も同様です。CDN上の静的ドキュメントです。[詳細については、このビデオをご覧ください][check-out-this-video-for-more-information-on-that]。

通常、キャッシュヘッダーの難しさは、それらを構成することです。Remixでは、それを簡単に行いました。ルートから`headers`関数をエクスポートするだけです。

```tsx
export function headers() {
  return {
    "Cache-Control": "public, max-age=300, s-maxage=3600",
  };
}

export function meta() {
  /* ... */
}

export default function Gists() {
  /* ... */
}
```

`max-age`は、ユーザーのブラウザに300秒、つまり5分間キャッシュするように指示します。つまり、5分以内に同じページに戻る場合、またはそのページへのリンクをクリックした場合、ブラウザはページのリクエストを行わず、キャッシュを使用します。

`s-maxage`は、CDNに1時間キャッシュするように指示します。これが、最初に人が私たちのウェブサイトにアクセスしたときの状況です。

1. ウェブサイトへのリクエストが送信され、これは実際にはCDNです
2. CDNはドキュメントをキャッシュしていないため、サーバー（「オリジンサーバー」）へのリクエストを送信します。
3. サーバーはページをビルドし、それをCDNに送信します
4. CDNはそれをキャッシュし、訪問者に送信します。

次に、次の訪問者が私たちのページにアクセスすると、次のようになります。

1. CDNへのリクエスト
2. CDNはすでにドキュメントをキャッシュしているため、オリジンサーバーに一切アクセスせずにすぐに送信します！

[CDNキャッシング][cdn-caching]ガイドでは、キャッシングについてさらに詳しく説明しますので、ぜひご覧ください。

## ローダー内

ルートはキャッシュコントロールを定義できることがわかりましたが、ローダーでそれが重要なのはなぜでしょうか。それは、2つの理由で重要です。

まず、データは通常、マークアップよりも頻繁に変更されるため、ルートよりもキャッシュコントロールが何であるかをよく知っています。そのため、ローダーのヘッダーはルートのヘッダー関数に渡されます。

`app/routes/gists.ts`を開いて、ヘッダー関数を次のように更新します。

```tsx
export function headers({
  loaderHeaders,
}: {
  loaderHeaders: Headers;
}) {
  return {
    "Cache-Control": loaderHeaders.get("Cache-Control"),
  };
}
```

`loaderHeaders`オブジェクトは、[Web Fetch API Headersコンストラクター][web-fetch-api-headers-constructor]のインスタンスです。

これで、ブラウザまたはCDNが私たちのページをキャッシュしようとすると、私たちのデータソースからのヘッダーを取得しますが、これは通常あなたが望むものです。私たちの例では、実際にはGitHubが私たちのフェッチからのレスポンスで送ったヘッダーを使用しているだけであることに注意してください！

これが重要な2番目の理由は、Remixがクライアント側の遷移でブラウザ内の`fetch`を介してローダーを呼び出すことです。ここで適切なキャッシュヘッダーを返すことで、ユーザーが戻る/進むをクリックしたり、同じページを複数回訪問したりした場合、ブラウザは実際にはデータの別のリクエストを行わず、代わりにキャッシュされたバージョンを使用します。これは、CDNでキャッシュできないページであっても、ウェブサイトのパフォーマンスを大幅に向上させます。多くのReactアプリはJavaScriptキャッシュに依存していますが、ブラウザキャッシュはすでにうまく機能しています！

[check-out-this-video-for-more-information-on-that]: https://youtu.be/bfLFHp7Sbkg
[cdn-caching]: ../guides/caching
[web-fetch-api-headers-constructor]: https://developer.mozilla.org/en-US/docs/Web/API/Headers


